# –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç Nest JS

1. [–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞](#—Å–æ–∑–¥–∞–Ω–∏–µ-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (—Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è –¥–ª—è –ë–î)](#–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-–∫-–±–¥-—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥—É–ª—è-–¥–ª—è-–±–¥)
3. [–ú–æ–¥—É–ª—å User](#–º–æ–¥—É–ª—å-user)
   1) [–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è User](#—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥—É–ª—è-user)
   2) [–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ User](#—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥–µ–ª–∏-user)
   3) [–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ User](#—Å–æ–∑–¥–∞–Ω–∏–µ-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞-user)
   4) [–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ User](#—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å–∞-user)
4. [Swagger](#swagger)
   1) [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Swagger](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-swagger)
   2) [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ User](#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞-user)
   3) [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ User –∏ dto](#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è-–º–æ–¥–µ–ª–∏-user-–∏-dto)
   4) [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏-–≤-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
5. [–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è Roles](#—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥—É–ª—è-roles)
   1) [–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ Roles](#—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥–µ–ª–∏-roles)
   2) [–°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ –º–æ–¥–µ–ª–µ–π (Roles (1) ‚Üí (‚àû) User)](#—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–≤—è–∑–∏-–º–æ–¥–µ–ª–µ–π-roles-1---user)
   3) [–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è Roles](#—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å–∞-–¥–ª—è-roles)
   4) [–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–ª—è Roles](#—Å–æ–∑–¥–∞–Ω–∏–µ-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞-–¥–ª—è-roles)
   5) [–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ Roles –∏ User](#–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ-—Å–µ—Ä–≤–∏—Å–æ–≤-roles-–∏-user)
6. [–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è Auth](#—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥—É–ª—è-auth)
   1) [–°–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ Auth](#—Å–æ–∑–¥–∞–Ω–∏–µ-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞-auth)
   2) [–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ Auth](#—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å–∞-auth)
      1) [–ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å—É User –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ Auth](#–ø–æ–ª—É—á–∞–µ–º-–¥–æ—Å—Ç—É–ø-–∫-—Å–µ—Ä–≤–∏—Å—É-user-–∏–∑-—Å–µ—Ä–≤–∏—Å–∞-auth)
      2) [JWT, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞](#jwt-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è-–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ-—Ç–æ–∫–µ–Ω–∞)
   3) [–°–æ–∑–¥–∞–Ω–∏–µ Guard –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º](#—Å–æ–∑–¥–∞–Ω–∏–µ-guard-–¥–ª—è-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è-–¥–æ—Å—Ç—É–ø–∞-–Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º)
<hr>

## –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
1.  –°–æ–∑–¥–∞—ë–º –ø—Ä–æ–µ–∫—Ç —Å –ø–æ–º–æ—â—å—é __NEST CLI__ `nest new .` –∏–ª–∏ `nest new *–Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞*`;
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º __Sequelize__ –∏ __oracledb__ (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –Ω—É–∂–Ω–æ–π –ë–î)<br>`npm install --save @nestjs/sequelize sequelize sequelize-typescript oracledb`<br>`npm install --save-dev @types/sequelize`
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ `npm install @nestjs/config` –∏ —Å–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª `.env`  
    ```
    //üìÅ.env
    PORT=4001  
    DB_DATABASE="XE"  
    DB_HOST="localhost"
    DB_USERNAME="yourascension"
    DB_PASSWORD="123456"
    DB_PORT=1521
    ```
<hr/>

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (—Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è –¥–ª—è –ë–î)
1. –° –ø–æ–º–æ—â—å—é __Nest CLI__ —Å–æ–∑–¥–∞–¥–∏–º –º–æ–¥—É–ª—å –¥–ª—è –ë–î. `nest generate module database`;
2. –í –º–æ–¥—É–ª—å `database` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ –∏ —É–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Ç—å –∫ `.env` —Ñ–∞–π–ª—É 
    ```TypeScript
   //TypeScript
   //üìÅsrc/database/database.module.ts
   
    import { Module } from '@nestjs/common';
    import {ConfigModule} from "@nestjs/config";
    import * as process from "process";

    @Module({
        imports: [ConfigModule.forRoot({envFilePath: '.env'})]
    })
    export class DatabaseModule {}
    
    console.log(process.env.PORT);
    ```
3. –¢–∞–∫–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª—å `Sequelize` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
    ```TypeScript
   //TypeScript
   //üìÅsrc/database/database.module.ts
   
    import { Module } from '@nestjs/common';
    import {ConfigModule} from "@nestjs/config";
    import {SequelizeModule} from "@nestjs/sequelize";
    
    @Module({
        imports: [ConfigModule.forRoot({envFilePath: '.env'}),
        SequelizeModule.forRoot({
            dialect: 'oracle',
            host: process.env.DB_HOST,
            port: Number(process.env.DB_PORT),
            username: process.env.DB_USERNAME,
            password: process.env.DB_PASSWORD,
            database: process.env.DB_DATABASE,
            autoLoadModels: true,
            synchronize: true,
            models: []
        })],
    })
    export class DatabaseModule {}
   ```
4. –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ë–î –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö, –≤ –º–æ–¥—É–ª—å `app.module.ts` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º `database.module.ts`
    ```TypeScript
   //TypeScript
   //üìÅsrc/app.module.ts
    import { Module } from '@nestjs/common';
    import { DatabaseModule } from './database/database.module';
    
    @Module({
        imports: [DatabaseModule],
        controllers: [],
        providers: [],
    })
    export class AppModule {}
   ```
   üí° –¢.–∫. –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ñ–∏–≥–æ–º `.env` –±—ã–ª –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ `database.module.ts`, —Ç–æ –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `app.module.ts`
    ```TypeScript
   //TypeScript
   //üìÅsrc/main.ts
    import { NestFactory } from '@nestjs/core';
    import { AppModule } from './app.module';
    import * as process from "process";

    async function bootstrap() {
        const PORT = process.env.PORT || 3001
        const app = await NestFactory.create(AppModule);
        await app.listen(PORT, ()=>console.log(`Server has been started on PORT = ${PORT}`));
    }
    bootstrap();
    ```
<hr/>

## –ú–æ–¥—É–ª—å User
### –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è User
1. –° –ø–æ–º–æ—â—å—é __Nest CLI__ —Å–æ–∑–¥–∞—ë–º –º–æ–¥—É–ª—å `nest generate module user`. –û–Ω –ø–æ–∫–∞ —á—Ç–æ –ø—É—Å—Ç.
    ```TypeScript
   //TypeScript
   //üìÅsrc/user/user.module.ts
    import { Module } from '@nestjs/common';
    
    @Module({
        imports: [],
        controllers: [],
        providers: []
    })
    export class UserModule {}
   ```
   üí° –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–¥—É–ª—è —Å –ø–æ–º–æ—â—å—é __NEST CLI__ –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –≥–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å `app.module.ts`.
    ```TypeScript
    //TypeScript
   //üìÅsrc/app.module.ts

    import { Module } from '@nestjs/common';
    import { DatabaseModule } from './database/database.module';
    import { UserModule } from './user/user.module';
    
    @Module({
        imports: [DatabaseModule, UserModule],
        controllers: [],
        providers: [],
    })
    export class AppModule {}
   ```
### –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ User
1. –°–æ–∑–¥–∞–¥–∏–º –º–æ–¥–µ–ª—å —é–∑–µ—Ä–∞ –¥–ª—è –ë–î –≤ —Ñ–∞–π–ª–µ `user.model.ts`
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.model.ts
    import {Table, Column, Model, PrimaryKey, DataType} from 'sequelize-typescript';
    
    //–°–æ–∑–¥–∞—ë–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –±—É–¥–µ–º —É–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —é–∑–µ—Ä–∞
    interface UserCreationAttribute {
        email: string;
        password: string
    }
    
    @Table({tableName: 'users-nest', timestamps: false})
    export class User extends Model<User, UserCreationAttribute> {
   
        @Column({type: DataType.INTEGER, unique: true, autoIncrement: true, primaryKey: true, allowNull: false})
        id: number;
    
        @Column({type: DataType.STRING, unique: true, allowNull: false})
        email: string;
    
        @Column({type: DataType.STRING, allowNull: false})
        password: string;
    
        @Column({type: DataType.BOOLEAN, defaultValue: false, allowNull: false})
        banned: boolean;
    }
   ```
2. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –µ—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –≤ –∏–º–ø–æ—Ä—Ç–∞—Ö –≤ –º–æ–¥—É–ª–µ `user.module.ts`
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.module.ts
    import { Module } from '@nestjs/common';
    import {SequelizeModule} from "@nestjs/sequelize";
    import {User} from "./user.model";
    
    @Module({
        imports: [SequelizeModule.forFeature([User])],
        controllers: [],
        providers: []
    })
    export class UserModule {}
   ```
3. –¢–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `user.module.ts` –≤ `database.module.ts` –∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ë–î —É–∫–∞–∑–∞—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å:
    ```TypeScript
    //TypeScript
   //üìÅsrc/database/database.module.ts
    import { Module } from '@nestjs/common';
    import {ConfigModule} from "@nestjs/config";
    import {SequelizeModule} from "@nestjs/sequelize";
    import {User} from "../user/user.model";
    import {UserModule} from "../user/user.module";
    
    @Module({
        imports: [ConfigModule.forRoot({envFilePath: '.env'}),
        SequelizeModule.forRoot({
            dialect: 'oracle',
            host: process.env.DB_HOST,
            port: Number(process.env.DB_PORT),
            username: process.env.DB_USERNAME,
            password: process.env.DB_PASSWORD,
            database: process.env.DB_DATABASE,
            autoLoadModels: true,
            synchronize: true,
            models: [User]
        }),
        UserModule],
    })
    export class DatabaseModule {}
   ```
### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ User
1. –° –ø–æ–º–æ—â—å—é __Nest CLI__ —Å–æ–∑–¥–∞–¥–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `nest generate controller user`. (–û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—Å—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã `user.module.ts`):
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.controller.ts
    import {Controller, Get} from '@nestjs/common';
    
    @Controller('users')
    export class UserController {
    
        @Get()
         getTest(){
            return 'Test controller getTest()'
        }
    }
   ```
2. –ï—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä, —Ç–æ —É–≤–∏–¥–∏–º —á—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç.
### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ User
1. –° –ø–æ–º–æ—â—å—é __Nest CLI__ —Å–æ–∑–¥–∞–¥–∏–º —Å–µ—Ä–≤–∏—Å `nest generate service user`. (–û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—Å—è –≤ —Å–µ—Ä–≤–∏—Å—ã `user.module.ts`);
2. –° –ø–æ–º–æ—â—å—é `@InjectModel` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –¥–æ–±–∞–≤–∏–º –º–æ–¥–µ–ª—å `User` –∏ –æ–±—ä—è–≤–∏–º –µ—ë –∫–∞–∫ `useRepository`. –ü–æ—Å–ª–µ —á–µ–≥–æ –Ω–∞–ø–∏—à–µ–º –º–µ—Ç–æ–¥ `getAllUsers`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤—Å–µ—Ö —é–∑–µ—Ä–æ–≤:
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.service.ts
    import { Injectable } from '@nestjs/common';
    import {InjectModel} from "@nestjs/sequelize";
    import {User} from "./user.model";
    
    @Injectable()
    export class UserService {
    constructor(@InjectModel(User) private userRepository: typeof User) {}
    
        async getAllUsers(){
            const users = this.userRepository.findAll();
            return users;
        }
    }
   ```
3. –¢.–∫. —Å–µ—Ä–≤–∏—Å —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `user.module.ts`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.module.ts
    import { Module } from '@nestjs/common';
    import {SequelizeModule} from "@nestjs/sequelize";
    import {User} from "./user.model";
    import { UserController } from './user.controller';
    import { UserService } from './user.service';
    
    @Module({
        imports: [SequelizeModule.forFeature([User])],
        controllers: [UserController],
        providers: [UserService]
    })
    export class UserModule {}
   ```
4. –¢–æ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏ —É–∫–∞–∂–µ–º –µ–≥–æ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∫–ª–∞—Å—Å–∞, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤—ã–∑—ã–≤–∞–µ–º —É –Ω–µ–≥–æ –º–µ—Ç–æ–¥ `getAllUsers`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.controller.ts
    import {Controller, Get} from '@nestjs/common';
    import {UserService} from "./user.service";
    
    @Controller('users')
    export class UserController {
    constructor(private readonly userService: UserService) {}
    
        @Get()
        getAllUsers() {
            return this.userService.getAllUsers()
        }
    }
   ```
5. –¢–µ–ø–µ—Ä—å –µ—Å–ª–∏ –º—ã –∑–∞–ø—É—Å—Ç–∏–º —Å–µ—Ä–≤–µ—Ä –∏ –ø–µ—Ä–µ–π–¥—ë–º –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É `localhost:4001/users`, —Ç–æ —É–≤–∏–¥–∏–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —é–∑–µ—Ä–æ–≤ (–¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –∑–∞—Ä–∞–Ω–µ–µ).
6. –í–µ—Ä–Ω—ë–º—Å—è –∫ `user.service.ts` —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —é–∑–µ—Ä–æ–≤. –ú–µ—Ç–æ–¥ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `createUser`, –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç dto (__Data-Transfer-Object__):
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.service.ts
    import {Injectable} from "@nestjs/common";
    import {User} from "./user.model";
    import {InjectModel} from "@nestjs/sequelize";
    import {CreateUserDto} from "./dto/create-user.dto";
    
    
    @Injectable()
    export class UserService {
    constructor(@InjectModel(User) private  userRepository: typeof User) {}
    
        async createUser(dto: CreateUserDto){
            const user = await this.userRepository.create(dto)
            return user;
        }
    
        async getAllUsers(){
            const users = await this.userRepository.findAll();
            return users;
        }
    }
   ```
   üí° dto - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–º—É –≤–∏–¥—É.<br> –í –ø–∞–ø–∫–µ user —Å–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É __dto__, –∞ –≤ –Ω–µ–π —Ñ–∞–π–ª `user-create.dto.ts` (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —é–∑–µ—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è):
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/dto/create-user.dto.ts
    export class CreateUserDto {
        readonly email: string;
        readonly password: string;
    }
   ```
7. –°–Ω–æ–≤–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏ —Å–æ–∑–¥–∞—ë–º –º–µ—Ç–æ–¥ `create` —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `@POST` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —é–∑–µ—Ä–∞. –ú–µ—Ç–æ–¥ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@Body` –∏ `userDto`:
    ```TypeScript
    //TypeScript
    //üìÅsrc/user/user.controller.ts
    import {Body, Controller, Get, Post} from '@nestjs/common';
    import {UserService} from "./user.service";
    import {CreateUserDto} from "./dto/create-user.dto";
    
    @Controller('users')
    export class UserController {
    constructor(private readonly userService: UserService) {}
    
        @Post()
        createUser(@Body() userDto: CreateUserDto){
            return this.userService.createUser(userDto)
        }
        @Get()
        getAllUsers() {
            return this.userService.getAllUsers()
        }
    }   
   ```
8. –¢–µ–ø–µ—Ä—å –µ—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏–º —Å–µ—Ä–≤–µ—Ä –∏ –æ—Ç–ø—Ä–∞–≤–∏–º POST –∑–∞–ø—Ä–æ—Å, —Ç–æ —Å–º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å —é–∑–µ—Ä–∞.
<hr/>

## Swagger
### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Swagger
1. –£—Å—Ç–∞–Ω–æ–≤–∏–º __Swagger__ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ `npm install @nestjs/swagger swagger-ui-express`;
2. –í —Ñ–∞–π–ª–µ `main.ts` —Å–æ–∑–¥–∞–¥–∏–º –∫–æ–Ω—Ñ–∏–≥ –∏ —Å–¥–µ–ª–∞–µ–º —Å–µ—Ç–∞–ø –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
    ```TypeScript
    //TypeScript
   //üìÅsrc/main.ts
   import {NestFactory} from '@nestjs/core';
   import {AppModule} from './app.module';
   import * as process from "process";
   import {DocumentBuilder, SwaggerModule} from "@nestjs/swagger";
   
   async function bootstrap() {
   const PORT = process.env.PORT || 3001
   const app = await NestFactory.create(AppModule);
   
       const config = new DocumentBuilder()
           .setTitle('–¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ')
           .setDescription('–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API')
           .setVersion('1.0.0')
           .addTag('YourAscension')
           .build();
       //–°–æ–∑–¥–∞—ë–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —É–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–∏–≥
       const document = SwaggerModule.createDocument(app, config)
       //–≠–Ω–¥–ø–æ–∏–Ω—Ç –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–µ–º –Ω–∞–π—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
       SwaggerModule.setup('api/docs', app, document);
       
       await app.listen(PORT, () => console.log(`Server has been started on PORT = ${PORT}`));
   }
   
   bootstrap();
   ```
3. –ü–µ—Ä–µ–π–¥—è –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É `api/docs` —É–≤–∏–¥–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.
### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ User
1. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:
   1. `@ApiTags('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏')` - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞;
   2. `@ApiOperation({summary: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})` -  –Ω–∞–∑–≤–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞;
   3. `@ApiResponse(), @ApiResponse({status: 200, type: User})` - –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞;
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.controller.ts
   import {Body, Controller, Get, Post} from '@nestjs/common';
   import {UserService} from "./user.service";
   import {CreateUserDto} from "./dto/create-user.dto";
   import {ApiTags, ApiOperation, ApiResponse} from "@nestjs/swagger";
   import {User} from "./user.model";
   
   @ApiTags('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏')
   @Controller('users')
   export class UserController {
   constructor(private readonly userService: UserService) {}
   
       @ApiOperation({summary: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
       @ApiResponse({status: 200, type: User})
       @Post()
       createUser(@Body() userDto: CreateUserDto){
           return this.userService.createUser(userDto)
       }
   
       @ApiOperation({summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'})
       @ApiResponse({status: 200, type: [User]})
       @Get()
       getAllUsers() {
           return this.userService.getAllUsers()
       }
   }
   ```
   ‚ö†Ô∏è–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ç–∞–∫–∂–µ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏.
### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ User –∏ dto
1. –° –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@ApiProperty` –º–æ–∂–Ω–æ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª–±—Ü—ã –º–æ–¥–µ–ª–∏. –£–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è –∏ –µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤:
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.model.ts
   @Table({tableName: 'users-nest', timestamps: false})
   export class User extends Model<User, UserCreationAttribute> {
        @ApiProperty({example: '1', description: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
        @Column({type: DataType.INTEGER, unique: true, autoIncrement: true, primaryKey: true, allowNull: false})
        id: number;
   
        @ApiProperty({example: 'placeholder@gmail.com', description: '–ü–æ—á—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å'})
        @Column({type: DataType.STRING, unique: true, allowNull: false})
        email: string;
   
        @ApiProperty({example: 'qwerty123', description: '–ü–∞—Ä–æ–ª—å'})
        @Column({type: DataType.STRING, allowNull: false})
        password: string;
   
        @ApiProperty({example: 'true', description: '–ó–∞–±–∞–Ω–µ–Ω –ª–∏'})
        @Column({type: DataType.BOOLEAN, defaultValue: false, allowNull: false})
        banned: boolean;
   }
   ```
2. –¢–∞–∫–∂–µ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ–º `create-user.dto.ts`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/dto/create-user.dto.ts
   import {ApiProperty} from "@nestjs/swagger";
   
   export class CreateUserDto {
        @ApiProperty({example: 'placeholder@gmail.com', description: '–ü–æ—á—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å'})
        readonly email: string;
   
        @ApiProperty({example: 'qwerty123', description: '–ü–∞—Ä–æ–ª—å'})
        readonly password: string;
   }
   ```
### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ `addBeareAuth`, –∏ –≤ —Å–µ—Ç–∞–ø–µ —É–∫–∞–∑–∞—Ç—å `{swaggerOptions : {persistAuthorization: true}}`
    ```TypeScript
   //TypeScript
   //üìÅsrc/main.ts
   import {NestFactory} from '@nestjs/core';
   import {AppModule} from './app.module';
   import * as process from "process";
   import {DocumentBuilder, SwaggerModule} from "@nestjs/swagger";
   
   async function bootstrap() {
   const PORT = process.env.PORT || 3001
   const app = await NestFactory.create(AppModule);
   
       const config = new DocumentBuilder()
           .setTitle('–¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ')
           .setDescription('–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API')
           .setVersion('1.0.0')
           .addTag('YourAscension')
           .addBearerAuth()
           .build();
       //–°–æ–∑–¥–∞—ë–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —É–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–∏–≥
       const document = SwaggerModule.createDocument(app, config)
       //–≠–Ω–¥–ø–æ–∏–Ω—Ç –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–µ–º –Ω–∞–π—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
       SwaggerModule.setup('api/docs', app, document, {swaggerOptions : {persistAuthorization: true}});
   
       await app.listen(PORT, () => console.log(`Server has been started on PORT = ${PORT}`));
   }
   
   bootstrap();
   ```
2. –£ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —É –∫–æ—Ç–æ—Ä—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `@UseGuards` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@ApiBearerAuth`, —á—Ç–æ–±—ã –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–º –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
    ```TypeScript
   //TypeScript
   //üìÅsrc/user/user.controller.ts
   import {Body, Controller, Get, Post, UseGuards} from '@nestjs/common';
   import {UserService} from "./user.service";
   import {CreateUserDto} from "./dto/create-user.dto";
   import {ApiBearerAuth, ApiOperation, ApiResponse, ApiTags} from "@nestjs/swagger";
   import {User} from "./user.model";
   import {JwtAuthGuard} from "../auth/jwt-auth.guard";
   
   @ApiTags('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏')
   @Controller('users')
   export class UserController {
   constructor(private readonly userService: UserService) {}
   
       @ApiOperation({summary: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
       @ApiResponse({status: 200, type: User})
       @Post()
       createUser(@Body() userDto: CreateUserDto){
           return this.userService.createUser(userDto)
       }
   
       @ApiOperation({summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'})
       @ApiResponse({status: 200, type: [User]})
       //
       @ApiBearerAuth()
       @UseGuards(JwtAuthGuard)
       @Get()
       getAllUsers() {
           return this.userService.getAllUsers()
       }
   }
   ```
<hr/>

## –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è Roles
–°–æ–∑–¥–∞–¥–∏–º –º–æ–¥—É–ª—å, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, —Å–µ—Ä–≤–∏—Å —Å –ø–æ–º–æ—â—å—é __Nest CLI__. `nest generate module roles`, `nest generate controller roles`, `nest generate service roles`. 
### –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ Roles
1. –°–æ–∑–¥–∞–¥–∏–º –º–æ–¥–µ–ª—å –¥–ª—è —Ä–æ–ª–µ–π `roles.model.ts`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/roles/roles.model.ts
   import {Table, Column, Model, DataType} from 'sequelize-typescript';
   import {ApiProperty} from "@nestjs/swagger";
   
   //–°–æ–∑–¥–∞—ë–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –±—É–¥–µ–º —É–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–æ–ª–∏
   interface RoleCreationAttribute {
    role: string
   }
   
   @Table({tableName: 'roles-nest', timestamps: false})
   export class Roles extends Model<Roles, RoleCreationAttribute> {
        @ApiProperty({example: '1', description: 'ID —Ä–æ–ª–∏'})
        @Column({type: DataType.INTEGER, unique: true, autoIncrement: true, primaryKey: true, allowNull: false})
        id: number;
   
        @ApiProperty({example: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', description: '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏'})
        @Column({type: DataType.STRING, unique: true, allowNull: false})
        role: string;
   }
   ```
2. –¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –º–æ–¥–µ–ª—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ –º–æ–¥—É–ª—é –ë–î –≤ `database.module.ts`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/database/database.module.ts
   import {Module} from '@nestjs/common';
   import {ConfigModule} from "@nestjs/config";
   import {SequelizeModule} from "@nestjs/sequelize";
   import {User} from "../user/user.model";
   import {UserModule} from "../user/user.module";
   import {Roles} from "../roles/roles.model";
   
   @Module({
        imports: [ConfigModule.forRoot({envFilePath: '.env'}),
        SequelizeModule.forRoot({
            dialect: 'oracle',
            host: process.env.DB_HOST,
            port: Number(process.env.DB_PORT),
            username: process.env.DB_USERNAME,
            password: process.env.DB_PASSWORD,
            database: process.env.DB_DATABASE,
            autoLoadModels: true,
            synchronize: true,
            models: [User, Roles]
        }),
        UserModule
    ],
   })
   export class DatabaseModule {
   }
   ```
3. –ê —Ç–∞–∫–∂–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –º–æ–¥–µ–ª—å –∫ –º–æ–¥—É–ª—é `roles.module.ts`:
    ```TypeScript
    //TypeScript
   //üìÅsrc//roles/roles.module.ts
   import { Module } from '@nestjs/common';
   import { RolesController } from './roles.controller';
   import { RolesService } from './roles.service';
   import {SequelizeModule} from "@nestjs/sequelize";
   import {Roles} from "./roles.model";
   
   @Module({
        imports: [SequelizeModule.forFeature([Roles])],
        controllers: [RolesController],
        providers: [RolesService]
   })
   export class RolesModule {}
   ```
### –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ –º–æ–¥–µ–ª–µ–π (Roles (1) ‚Üí (‚àû) User)
1. –£ —é–∑–µ—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–¥–Ω–∞ —Ä–æ–ª—å. –¢.–µ. –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å–≤—è–∑—å: __role (1) ‚Üí (‚àû) user__'s. –ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—å, –ø–µ—Ä–µ–π–¥—ë–º –∫ –º–æ–¥–µ–ª–∏ `user.model.ts`:
   1. –°–æ–∑–¥–∞–¥–∏–º —Å—Ç–æ–ª–±–µ—Ü `roleId` –∏ —Å –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ —É–∫–∞–∂–µ–º, —á—Ç–æ –æ–Ω —è–≤–ª—è–µ—Ç—Å—è `ForeignKey` –¥–ª—è –º–æ–¥–µ–ª–∏ `Roles` —Å –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@ForeignKey`;
   2. –° –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@BelongsTo` —Å–æ–∑–¥–∞–¥–∏–º —Å–≤—è–∑—å —Å –º–æ–¥–µ–ª—å—é `Roles`;
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.model.ts
   import {Table, Column, Model, PrimaryKey, DataType, BelongsTo, ForeignKey} from 'sequelize-typescript';
   import {ApiProperty} from "@nestjs/swagger";
   import {Role} from "../roles/roles.model";
   
   interface UserCreationAttribute {
        email: string;
        password: string
   }
   
   @Table({tableName: 'users-nest', timestamps: false})
   export class User extends Model<User, UserCreationAttribute> {
        @ApiProperty({example: '1', description: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
        @Column({type: DataType.INTEGER, unique: true, autoIncrement: true, primaryKey: true, allowNull: false})
        id: number;
        @ApiProperty({example: 'placeholder@gmail.com', description: '–ü–æ—á—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å'})
        @Column({type: DataType.STRING, unique: true, allowNull: false})
        email: string;
        @ApiProperty({example: 'qwerty123', description: '–ü–∞—Ä–æ–ª—å'})
        @Column({type: DataType.STRING, allowNull: false})
        password: string;
        @ApiProperty({example: 'true', description: '–ó–∞–±–∞–Ω–µ–Ω –ª–∏'})
        @Column({type: DataType.BOOLEAN, defaultValue: false, allowNull: false})
        banned: boolean;
   
        @ApiProperty({example: '1', description: 'ID —Ä–æ–ª–∏'})
        @ForeignKey(() => Roles,)
        @Column({type: DataType.INTEGER})
        roleId: number
   
        @BelongsTo(() => Roles, {onDelete: 'cascade'})
        roles: Roles
   }
   ```
### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è Roles
1. –í —Ñ–∞–π–ª–µ `roles.service.ts` –∑–∞–∏–Ω–∂–µ–∫—Ç–∏–º –º–æ–¥–µ–ª—å `Role` –∏ —Å–æ–∑–¥–∞–¥–∏–º –¥–≤–∞ –º–µ—Ç–æ–¥–∞: `createRole` –∏ `getRoleByValue`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/roles/roles.service.ts
   
   import { Injectable } from '@nestjs/common';
   import {CreateRoleDto} from "./dto/create-role.dto";
   import {InjectModel} from "@nestjs/sequelize";
   import {Roles} from "./roles.model";
   
   @Injectable()
   export class RolesService {
   constructor(@InjectModel(Roles) private roleRepository: typeof Roles) {
   }
   
       async createRole(dto: CreateRoleDto){
           const role = await this.roleRepository.create(dto);
           return role;
       }
   
       async getRoleByValue(value: string) {
           const role = this.roleRepository.findOne({where: {role: value}})
           return role;
       }
   }
   ```
    ```TypeScript
    //TypeScript
   //üìÅsrc/roles/dto/create-role.dto.ts
   import {ApiProperty} from "@nestjs/swagger";
   
   export class CreateRoleDto {
        @ApiProperty({example: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', description: '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏'})
        readonly role: string;
   }
   ```
### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–ª—è Roles
1. –°–æ–∑–¥–∞–¥–∏–º –¥–≤–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞. –í —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ `@Get(‚Äô:/value‚Äô)` —Å –ø–æ–º–æ—â—å—é `URI` –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –¥–æ—Å—Ç–∞—ë–º –∑–Ω–∞—á–µ–Ω–∏–µ `value`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/roles/roles.controller.ts
   
   import {Body, Controller, Post, Get, Param} from '@nestjs/common';
   import {RolesService} from "./roles.service";
   import {CreateRoleDto} from "./dto/create-role.dto";
   
   @Controller('roles')
   export class RolesController {
   constructor(private rolesService: RolesService) {
   }
   
       @Post()
       create(@Body() dto: CreateRoleDto) {
           return this.rolesService.createRole(dto)
       }
   
       @Get('/:value')
       getByName(@Param('value') value: string){
           return this.rolesService.getRoleByValue(value);
       }
   }   
   ```
### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ Roles –∏ User
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –µ–º—É –ø—Ä–∏—Å–≤–∞–∏–≤–∞—Ç—å –∫–∞–∫—É—é-—Ç–æ —Ä–æ–ª—å. –ß—Ç–æ–±—ã –º—ã –∏–º–µ–ª–∏ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å—É `Roles` –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ `User` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ–π—Å—Ç–≤–∏–π:
   1. –í `roles.module.ts` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ `exports` —É–∫–∞–∑–∞—Ç—å `roles.service.ts` (—Ç.–µ. –º—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å):
      ```TypeScript
      //TypeScript
      //üìÅsrc/roles/roles.module.ts
      import { Module } from '@nestjs/common';
      import { RolesController } from './roles.controller';
      import { RolesService } from './roles.service';
      import {SequelizeModule} from "@nestjs/sequelize";
      import {Roles} from "./roles.model";

      @Module({
      imports: [SequelizeModule.forFeature([Roles])],
      controllers: [RolesController],
      providers: [RolesService],
      exports: [RolesService]
      })
      export class RolesModule {}
      ```
   2. –¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ `user.module.ts` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –º–æ–¥—É–ª—å `roles.module.ts`:
      ```TypeScript
      //TypeScript
      //üìÅsrc/user/user.module.ts
      import { Module } from '@nestjs/common';
      import {SequelizeModule} from "@nestjs/sequelize";
      import {User} from "./user.model";
      import { UserController } from './user.controller';
      import { UserService } from './user.service';
      import {RolesModule} from "../roles/roles.module";
   
      @Module({
         imports: [SequelizeModule.forFeature([User]), RolesModule],
         controllers: [UserController],
         providers: [UserService]
      })
      export class UserModule {}
      ```
   3. –ü–æ—Å–ª–µ —á–µ–≥–æ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `RolesService` –≤ `user.service.ts`:
      ```TypeScript
      //TypeScript
      //üìÅsrc/user/user.service.ts
      import { Injectable } from '@nestjs/common';
      import {InjectModel} from "@nestjs/sequelize";
      import {User} from "./user.model";
      import {CreateUserDto} from "./dto/create-user.dto";
      import {RolesService} from "../roles/roles.service";

      @Injectable()
      export class UserService {
      constructor(@InjectModel(User) private userRepository: typeof User, private roleService: RolesService) {}

      async getAllUsers(){
        const users = this.userRepository.findAll();
        return users;
        }

      async createUser(dto: CreateUserDto){
        const user = await this.userRepository.create(dto)
        return user;
        }
      }
      ```
2. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å–æ–∑–¥–∞–¥–∏–º —é–∑–µ—Ä–∞ —Å–¥–µ–ª–∞–µ—Ç `update` –∏ –¥–æ–±–∞–≤–∏–º –µ–º—É —Ä–æ–ª—å:
   ```TypeScript
   //TypeScript
   //üìÅsrc/user/user.service.ts
   import { Injectable } from '@nestjs/common';
   import {InjectModel} from "@nestjs/sequelize";
   import {User} from "./user.model";
   import {CreateUserDto} from "./dto/create-user.dto";
   import {RolesService} from "../roles/roles.service";
   
   @Injectable()
   export class UserService {
      constructor(@InjectModel(User) private userRepository: typeof User, private roleService: RolesService) {}
   
      async getAllUsers(){
         const users = this.userRepository.findAll();
         return users;
      }
   
      async createUser(dto: CreateUserDto){
         const user = await this.userRepository.create(dto)
   
         //–í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º —Ä–æ–ª—å –∫–æ—Ç–æ—Ä–∞—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è USER
         const role = await this.roleService.getRoleByValue('USER');
   
         //–î–µ–ª–∞–µ–º update, –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–≤—è–∑–∏ roles(‚ö†Ô∏è–Ω–µ –∫ —Å—Ç–æ–ª–±—Ü—É roleid) –∏ —É–∫–∞–∑—ã–≤–∞–µ–º id
         await user.$set('roles', role.id);
         return user;
      }
   }
   ```
3. –î–æ–ø–æ–ª–Ω–∏–º –º–µ—Ç–æ–¥ `getAllUsers`. –ï—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å `findAll({include: true;})`, —Ç–æ –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∂–æ–∏–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:
   ```TypeScript
   //TypeScript
   //üìÅsrc/user/user.service.ts
   import { Injectable } from '@nestjs/common';
   import {InjectModel} from "@nestjs/sequelize";
   import {User} from "./user.model";
   import {CreateUserDto} from "./dto/create-user.dto";
   import {RolesService} from "../roles/roles.service";
   
   @Injectable()
   export class UserService {
   constructor(@InjectModel(User) private userRepository: typeof User, private roleService: RolesService) {}
   
       async getAllUsers(){
           const users = this.userRepository.findAll({include: {all: true});
           return users;
       }
   
       async createUser(dto: CreateUserDto){
           const user = await this.userRepository.create(dto)
   
           //–í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º —Ä–æ–ª—å –∫–æ—Ç–æ—Ä–∞—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è USER
           const role = await this.roleService.getRoleByValue('USER');
   
           //–î–µ–ª–∞–µ–º update, –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–≤—è–∑–∏ roles(‚ö†Ô∏è–Ω–µ –∫ —Å—Ç–æ–ª–±—Ü—É roleid) –∏ —É–∫–∞–∑—ã–≤–∞–µ–º id
           await user.$set('roles', role.id);
           user.roles = role; //‚ö†Ô∏è–ö–æ—Å—Ç—ã–ª—å, —á—Ç–æ–±—ã –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç–µ –±—ã–ª–∞ —Ä–æ–ª—å
           return user;
       }
   }
   ```
<hr/>

## –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è Auth
1. –°–æ–∑–¥–∞—ë–º –º–æ–¥—É–ª—å, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏ —Å–µ—Ä–≤–∏—Å —Å –ø–æ–º–æ—â—å—é Nest CLI `nest generate module auth`, `nest generate service auth`, `nest generate controller auth`.<br> –¢–∞–∫ –∂–µ –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å __JWT__ –∏ __bcryptjs__ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª—è: `npm install @nestjs/jwt bcryptjs`
### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ Auth
1. –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–ª–∞—Å—Å–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∑–∞–∏–Ω–∂–µ–∫—Ç–∏–º `AuthService`, –ø–æ—Å–ª–µ —á–µ–≥–æ —Å–æ–∑–¥–∞–¥–∏–º –¥–≤–∞ POST –º–µ—Ç–æ–¥–∞:
   1) `login(@Body() userDto: **CreateUserDto**)` - –º–µ—Ç–æ–¥ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏;
   2) `registration(@Body() userDto: **CreateUserDto**)` - –º–µ—Ç–æ–¥ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
   ```TypeScript
   //TypeScript
   //üìÅsrc/auth/auth.controller.ts
   import {Controller, Post, Body} from '@nestjs/common';
   import {ApiTags} from "@nestjs/swagger";
   import {CreateUserDto} from "../user/dto/create-user.dto";
   import {AuthService} from "./auth.service";
   
   @ApiTags('–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è')
   @Controller('auth')
   export class AuthController {
        constructor(private authService: AuthService) {
        }
        @Post('/login')
        login(@Body() userDto: CreateUserDto){
        return this.authService.login(userDto);
        }
   
       @Post('/registration')
       registration(@Body() userDto: CreateUserDto){
           return this.authService.registration(userDto);
       }
   }
   ```
### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ Auth
#### –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å—É User –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ Auth
1. –í `auth.service.ts` —Ä–µ–∞–ª–∏–∑—É–µ–º –º–µ—Ç–æ–¥—ã –¥–ª—è **–ª–æ–≥–∏–Ω–∞** –∏ **—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**. –ù—É–∂–Ω–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ —é–∑–µ—Ä–∞–º–∏, –ø–æ—ç—Ç–æ–º—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `user.service.ts`
   1) –í `auth.service.ts` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `userService`:

    ```TypeScript
   //TypeScript
    //üìÅsrc/user/user.service.ts
    import {Injectable} from '@nestjs/common';
    import {CreateUserDto} from "../user/dto/create-user.dto";
    import {UserService} from "../user/user.service";
    
    @Injectable()
    export class AuthService {
        constructor(private userService: UserService) {
        }
    
        async login(userDto: CreateUserDto){
        }
    
        async registration(userDto: CreateUserDto){
        }
    }
    ```

2. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ `auth.module.ts`, –≤ `imports` —É–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥—É–ª—å, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –º–µ—Ç–æ–¥. (–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ `UserService` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `UserModule`, –ø–æ—ç—Ç–æ–º—É –∏–º–ø–æ—Ä–∏—Ç—Ä—É–µ–º –µ–≥–æ):

    ```TypeScript
   //TypeScript
    //üìÅsrc/auth/auth.module.ts
    import { Module } from '@nestjs/common';
    import { AuthService } from './auth.service';
    import { AuthController } from './auth.controller';
    import {UserModule} from "../user/user.module";
    
    @Module({
      providers: [AuthService],
      controllers: [AuthController],
      imports: [UserModule] // <--
    })
    export class AuthModule {}
    ```

3. –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –º–æ–¥—É–ª—é `user.module.ts` –∏ —É–∫–∞–∂–µ–º –≤ `exports` —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å. (–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ `UserService`):

    ```TypeScript
   //TypeScript
    //üìÅsrc/user/user.module.ts
    
    import { Module } from '@nestjs/common';
    import {SequelizeModule} from "@nestjs/sequelize";
    import {User} from "./user.model";
    import { UserController } from './user.controller';
    import { UserService } from './user.service';
    import {RolesModule} from "../roles/roles.module";
    
    @Module({
        imports: [SequelizeModule.forFeature([User]), RolesModule],
        controllers: [UserController],
        providers: [UserService],
        exports: [UserService] // <--
    })
    export class UserModule {}
    ```
#### JWT, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

1. –î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–µ—Ä–µ–π–¥—ë–º –≤ `user.service.ts` –∏ —Ä–µ–∞–ª–∏–∑—É–µ–º –º–µ—Ç–æ–¥ `getUserByEmail`:

    ```TypeScript
   //TypeScript
    //üìÅsrc/user/user.service.ts
    
    import { Injectable } from '@nestjs/common';
    import {InjectModel} from "@nestjs/sequelize";
    import {User} from "./user.model";
    import {CreateUserDto} from "./dto/create-user.dto";
    import {RolesService} from "../roles/roles.service";
    
    @Injectable()
    export class UserService {
        constructor(@InjectModel(User) private userRepository: typeof User, private roleService: RolesService) {}
    
        async getAllUsers(){
            const users = this.userRepository.findAll({include: {all: true}});
            return users;
        }
    
        async createUser(dto: CreateUserDto){
            const user = await this.userRepository.create(dto)
            const role = await this.roleService.getRoleByValue('USER');
            await user.$set('roles', role.id);
    				user.roles = role; //‚ö†Ô∏è–ö–æ—Å—Ç—ã–ª—å, —á—Ç–æ–±—ã –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç–µ –±—ã–ª–∞ —Ä–æ–ª—å
            return user;
        }
    
        async getUserByEmail(email: string){
            const user = await this.userRepository.findOne({where: {email: email}, include: {all: true}});
            return user;
        }
    }
    ```

2. –í `auth.module.ts` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º **`JwtModule.register`**, —É–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –∏ —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞:

    ```TypeScript
   //TypeScript
    //üìÅsrc/auth/auth.module.ts
    import { Module } from '@nestjs/common';
    import { AuthService } from './auth.service';
    import { AuthController } from './auth.controller';
    import {UserModule} from "../user/user.module";
    import {JwtModule} from "@nestjs/jwt";
    import * as process from "process";
    import {ConfigModule} from "@nestjs/config";
    
    @Module({
      providers: [AuthService],
      controllers: [AuthController],
      imports: [UserModule,
      
      JwtModule.register({
    		ConfigModule.forRoot({envFilePath: '.env'}),
        secret: process.env.SECRET_KEY,
        signOptions: {
          expiresIn: '24h'
        }
      })
      ]
    })
    export class AuthModule {}
    ```

3. –í `auth.service.ts` —Ä–µ–∞–ª–∏–∑—É–µ–º –º–µ—Ç–æ–¥—ã `registration`, `generateToken`, `login`, `validateuser`:
   1. `registration(userDto: **CreateUserDto**)` - –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–æ–π —é–∑–µ—Ä, –µ—Å–ª–∏ –Ω–µ—Ç, —Ç–æ —Ö—ç—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å –∏ —Å–æ–∑–¥–∞—ë–º –µ–≥–æ, –∞ —Ç–∞–∫–∂–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω;
   2. `generateToken(user: **User**)` - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω;
   3. `login(userDto: CreateUserDto)` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω;
   4. `validateUser(userDto: **CreateUserDto**)` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–æ–π —é–∑–µ—Ä –≤ –ë–î, –∑–∞—Ç–µ–º —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–∞—Ä–æ–ª–∏;

    ```TypeScript
   //TypeScript
    //üìÅsrc/auth/auth.service.ts
    
    import {HttpException, HttpStatus, Injectable, UnauthorizedException} from '@nestjs/common';
    import {CreateUserDto} from "../user/dto/create-user.dto";
    import {UserService} from "../user/user.service";
    import {JwtService} from "@nestjs/jwt";
    import * as bcrypt from 'bcryptjs'
    import {User} from "../user/user.model";
    
    @Injectable()
    export class AuthService {
        constructor(private userService: UserService, private jwtService: JwtService) {
        }
    
        async login(userDto: CreateUserDto){
            const user = await this.validateUser(userDto);
            return this.generateToken(user)
        }
    
        async registration(userDto: CreateUserDto){
            const candidate = await this.userService.getUserByEmail(userDto.email);
            if (candidate){
                throw new HttpException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', HttpStatus.BAD_REQUEST)
            }
            const hashPassword =await bcrypt.hash(userDto.password, 5);
            const user = await this.userService.createUser({...userDto, password: hashPassword})
            return this.generateToken(user)
        }
    
        private async generateToken(user: User) {
            const payload = {email: user.email, id: user.id, role: user.roles}
            return {
                token: this.jwtService.sign(payload)
            }
        }
    
        private async validateUser(userDto: CreateUserDto) {
            const user = await this.userService.getUserByEmail(userDto.email)
    
            if (user){
                const passwordEquals = await bcrypt.compare(userDto.password, user.password)
                if (passwordEquals){
                    return user
                }
            }
            throw new UnauthorizedException({message: '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å'})
        }
    }
    ```
### –°–æ–∑–¥–∞–Ω–∏–µ Guard –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

–ë–ª–∞–≥–æ–¥–∞—Ä—è –≥–≤–∞—Ä–¥–∞–º –º–æ–∂–Ω–æ –∑–∞–ø—Ä–µ—â–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º –ø–æ –∫–∞–∫–æ–º—É-–ª–∏–±–æ —É—Å–ª–æ–≤–∏—é.

1. –í –ø–∞–ø–∫–µ `auth` —Å–æ–∑–¥–∞–¥–∏–º –≥–≤–∞—Ä–¥ `jwt-auth.guard.ts`. –ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–Ω–∂–µ–∫—Ç–∏—Ä—É–µ–º—ã–º (–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@Injectable`). –¢–∞–∫–∂–µ —ç—Ç–æ—Ç –∫–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `CanActivate`. –í –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `context`. –°—É—Ç—å —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ç–æ–º, —á—Ç–æ –∫–æ–≥–¥–∞ –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false` - –¥–æ—Å—Ç—É–ø **–∑–∞–ø—Ä–µ—â—ë–Ω**, `true` - **—Ä–∞–∑—Ä–µ—à—ë–Ω**. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å JWT –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∫–ª–∞—Å—Å–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å `JwtService`:

    ```TypeScript
   //TypeScript
    //üìÅsrc/auth/jwt-auth.guard.ts
    
    import {CanActivate, ExecutionContext, Injectable, UnauthorizedException} from "@nestjs/common";
    import {Observable} from "rxjs";
    import {JwtService} from "@nestjs/jwt";
    
    @Injectable()
    export class JwtAuthGuard implements CanActivate {
        constructor(private jwtService: JwtService) {
        }
        canActivate(context: ExecutionContext): boolean | Promise<boolean> | Observable<boolean> {
            const request = context.switchToHttp().getRequest()
            try {
                //–í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º Authorization –∏–∑ header –∑–∞–ø—Ä–æ—Å–∞
                const autHeader = request.headers.authorization;
                const bearer = autHeader.split(' ')[0]
                const token = autHeader.split(' ')[1]
                //–ï—Å–ª–∏ —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞ –Ω–µ Bearer –∏–ª–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç, —Ç–æ –æ—à–∏–±–∫–∞
                if (bearer !=='Bearer' || !token){
                    throw new UnauthorizedException({message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'})
                }
                console.log(token)
    
                //–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
                const user = this.jwtService.verify(token);
                request.user = user;
                return true;
            }
            catch (e) {
                throw new UnauthorizedException({message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'})
            }
        }
    }
    ```

2. –ò–∑ `auth.module.ts` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º `~~AuthService` –∏~~ `JwtModule` (—Ç.–µ. –≤ –ì–≤–∞—Ä–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å –∏–∑ —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è):
   <br>‚ö†Ô∏è–ù–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–π `@Guard` –≤ –º–æ–¥—É–ª–µ `User`. –¢.–∫. –º–æ–¥—É–ª–∏ `Auth` –∏ `User` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–µ, —Ç–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∫–æ–ª—å—Ü–µ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å. –ß—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç—É –æ—à–∏–±–∫—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –º–æ–¥—É–ª—å `Auth` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `User` —Å –ø–æ–º–æ—â—å—é `forwardRef`: `forwardRef(()=>UserModule)`

    ```TypeScript
   //TypeScript
    //üìÅsrc/auth/auth.module.ts
    
    import {Module} from '@nestjs/common';
    import { AuthService } from './auth.service';
    import { AuthController } from './auth.controller';
    import {UserModule} from "../user/user.module";
    import {JwtModule} from "@nestjs/jwt";
    import * as process from "process";
    import {ConfigModule} from "@nestjs/config";
    
    @Module({
      providers: [AuthService],
      controllers: [AuthController],
      imports: [
      ConfigModule.forRoot({envFilePath: '.env'}),
    	//–î–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–ª—å—Ü–µ–≤–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é
      forwardRef(()=>UserModule),
      JwtModule.register({
        secret: process.env.SECRET_KEY,
        signOptions: {
          expiresIn: '24h'
        }
      })
      ],
      //–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º 
      exports: [
          AuthService,
          JwtModule
      ]
    })
    export class AuthModule {}
    ```

3. `@Guard` –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –º–æ–¥—É–ª–µ `User`. –ö–∞–∫ –±—ã–ª–æ —Å–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ, –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏ –æ–±—Ä–∞–∑—É–µ—Ç—Å—è –∫–æ–ª—å—Ü–µ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –ø–æ—ç—Ç–æ–º—É `AuthModule` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –º–æ–¥—É–ª—å `User` —Å –ø–æ–º–æ—â—å—é `forwardRef`: `forwardRef(()=>AuthModule)`:

    ```TypeScript
   //TypeScript
    //üìÅsrc/user/user.module.ts
    import {forwardRef, Module} from '@nestjs/common';
    import {SequelizeModule} from "@nestjs/sequelize";
    import {User} from "./user.model";
    import { UserController } from './user.controller';
    import { UserService } from './user.service';
    import {RolesModule} from "../roles/roles.module";
    import {AuthModule} from "../auth/auth.module";
    
    @Module({
        imports: [
            SequelizeModule.forFeature([User]),
            RolesModule,
    				//–î–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–ª—å—Ü–µ–≤–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
            forwardRef(()=>AuthModule),
        ],
        controllers: [UserController],
        providers: [UserService],
        exports: [UserService]
    })
    export class UserModule {}
    ```

   üí° –¢.–µ. –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª–∏ –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —ç—Ç–æ –¥–µ–ª–∞—Ç—å —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ `forwardRef`.

4. –ü–µ—Ä–µ–π–¥—ë–º –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É `user.controller.ts`, –º–µ—Ç–æ–¥—É `getAllUsers` –¥–æ–±–∞–≤–∏–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@UseGuards`, –∫–æ—Ç–æ—Ä—ã–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π `JwtAuthGuard`:

    ```TypeScript
   //TypeScript
    //üìÅsrc/user/user.controller.ts
    
    import {Body, Controller, Get, Post, UseGuards} from '@nestjs/common';
    import {UserService} from "./user.service";
    import {CreateUserDto} from "./dto/create-user.dto";
    import {ApiOperation, ApiResponse, ApiTags} from "@nestjs/swagger";
    import {User} from "./user.model";
    import {JwtAuthGuard} from "../auth/jwt-auth.guard";
    
    @ApiTags('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏')
    @Controller('users')
    export class UserController {
        constructor(private readonly userService: UserService) {}
    
        @ApiOperation({summary: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
        @ApiResponse({status: 200, type: User})
        @Post()
        createUser(@Body() userDto: CreateUserDto){
            return this.userService.createUser(userDto)
        }
    
        @ApiOperation({summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'})
        @ApiResponse({status: 200, type: [User]})
        //–ì–≤–∞—Ä–¥
        @UseGuards(JwtAuthGuard)
        @Get()
        getAllUsers() {
            return this.userService.getAllUsers()
        }
    }
    ```

5. –¢–µ–ø–µ—Ä—å –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É `localhost:4001/users` —Å –º–µ—Ç–æ–¥–æ–º GET –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ `Headers` —É–∫–∞–∑—ã–≤–∞—Ç—å `Authorization` c —Ç–æ–∫–µ–Ω–æ–º.