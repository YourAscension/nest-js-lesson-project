# –£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç Nest JS

1. [–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞](#—Å–æ–∑–¥–∞–Ω–∏–µ-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (—Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è –¥–ª—è –ë–î)](#–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-–∫-–±–¥-—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥—É–ª—è-–¥–ª—è-–±–¥)
3. [–ú–æ–¥—É–ª—å User](#–º–æ–¥—É–ª—å-user)
   1) [–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è User](#—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥—É–ª—è-user)
   2) [–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ User](#—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥–µ–ª–∏-user)
   3) [–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ User](#—Å–æ–∑–¥–∞–Ω–∏–µ-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞-user)
   4) [–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ User](#—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å–∞-user)
4. [Swagger](#swagger)
   1) [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Swagger](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-swagger)
   2) [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ User](#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞-user)
   3) [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ User –∏ dto](#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è-–º–æ–¥–µ–ª–∏-user-–∏-dto)
   4) [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏-–≤-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
5. [–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è Roles](#—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥—É–ª—è-roles)
   1) [–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ Roles](#—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥–µ–ª–∏-roles)
   2) [–°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ –º–æ–¥–µ–ª–µ–π (Roles (1) ‚Üí (‚àû) User)](#—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–≤—è–∑–∏-–º–æ–¥–µ–ª–µ–π-roles-1---user)
   3) [–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è Roles](#—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å–∞-–¥–ª—è-roles)
   4) [–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–ª—è Roles](#—Å–æ–∑–¥–∞–Ω–∏–µ-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞-–¥–ª—è-roles)
   5) [–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ Roles –∏ User](#–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ-—Å–µ—Ä–≤–∏—Å–æ–≤-roles-–∏-user)
6. [–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è Auth](#—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥—É–ª—è-auth)
   1) [–°–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ Auth](#—Å–æ–∑–¥–∞–Ω–∏–µ-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞-auth)
   2) [–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ Auth](#—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å–∞-auth)
      1) [–ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å—É User –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ Auth](#–ø–æ–ª—É—á–∞–µ–º-–¥–æ—Å—Ç—É–ø-–∫-—Å–µ—Ä–≤–∏—Å—É-user-–∏–∑-—Å–µ—Ä–≤–∏—Å–∞-auth)
      2) [JWT, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞](#jwt-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è-–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ-—Ç–æ–∫–µ–Ω–∞)
   3) [–°–æ–∑–¥–∞–Ω–∏–µ Guard –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º](#—Å–æ–∑–¥–∞–Ω–∏–µ-guard-–¥–ª—è-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è-–¥–æ—Å—Ç—É–ø–∞-–Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º)
   4) [Roles Guard –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞](#roles-guard-–¥–ª—è-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è-–¥–æ—Å—Ç—É–ø–∞-–ø–æ-—Ä–æ–ª—è–º-—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ-–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞)
   5) [–†–∞–∑–¥–∞—á–∞ —Ä–æ–ª–µ–π –∏ –±–∞–Ω–æ–≤](#—Ä–∞–∑–¥–∞—á–∞-—Ä–æ–ª–µ–π-–∏-–±–∞–Ω–æ–≤)
7. [–í–∞–ª–∏–¥–∞—Ü–∏—è. Pipes –∏ class-validator](#–≤–∞–ª–∏–¥–∞—Ü–∏—è-pipes-–∏-class-validator)
8. [–ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è pipe –æ—Ç middleware –≤ NestJS](#—á–µ–º-–æ—Ç–ª–∏—á–∞–µ—Ç—Å—è-pipe-–æ—Ç-middleware-–≤-nestjs)
9. [–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π Posts –∏ Files](#—Å–æ–∑–¥–∞–Ω–∏–µ-–º–æ–¥—É–ª–µ–π-posts-–∏-files)
   1) [–ú–æ–¥—É–ª—å Posts](#–º–æ–¥—É–ª—å-posts)
   2) [–ú–æ–¥—É–ª—å Files](#–º–æ–¥—É–ª—å-files)
   3) [Serve static](#serve-static)
10. [–ù–∞—á–∞–ª–æ](#–Ω–∞—á–∞–ª–æ)
11. [e2e —Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ User (Post, Get, Delete)](#e2e-—Ç–µ—Å—Ç—ã-–¥–ª—è-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞-user-post-get-delete)
    1) [–§—É–Ω–∫—Ü–∏—è describe, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∏–Ω–∏—Ü–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è App](#—Ñ—É–Ω–∫—Ü–∏—è-describe-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è-–∏-–∏–Ω–∏—Ü–∞–ª–∏–∑–∞—Ü–∏—è-–º–æ–¥—É–ª—è-app)
    2) [–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ —Ç–µ—Å—Ç–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](#–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ-–ª–æ–≥–∏–∫–∏-—Å–æ–∑–¥–∞–Ω–∏—è-—Ç–µ—Å—Ç–æ–≤-–Ω–∞-–ø—Ä–∏–º–µ—Ä–µ-—Ç–µ—Å—Ç–∞-–Ω–∞-—Å–æ–∑–¥–∞–Ω–∏–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    3) [–¢–µ—Å—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ](#—Ç–µ—Å—Ç—ã-—Å-–ø—Ä–æ–≤–µ—Ä–∫–æ–π-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤-–ø—Ä–∏-—É—Å–ø–µ—Ö–µ)
    4) [–¢–µ—Å—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ](#—Ç–µ—Å—Ç-—Å-–ø—Ä–æ–≤–µ—Ä–∫–æ–π-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞-–ø—Ä–∏-–æ—à–∏–±–∫–µ)
    5) [–¢–µ—Å—Ç—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π](#—Ç–µ—Å—Ç—ã-—Å-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π)
<hr>

## –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
1.  –°–æ–∑–¥–∞—ë–º –ø—Ä–æ–µ–∫—Ç —Å –ø–æ–º–æ—â—å—é __NEST CLI__ `nest new .` –∏–ª–∏ `nest new *–Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞*`;
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º __Sequelize__ –∏ __oracledb__ (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –Ω—É–∂–Ω–æ–π –ë–î)<br>`npm install --save @nestjs/sequelize sequelize sequelize-typescript oracledb`<br>`npm install --save-dev @types/sequelize`
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: __@nestjs/config__ - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ –∏ __cross-env__ - –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞ `npm install @nestjs/config cross-env.` –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª—ã `.env.development` –∏ `.env.production`.
    ```
   //üìÅ.env.development
   PORT=4001
   DB_DATABASE="XE"
   DB_HOST="localhost"
   DB_USERNAME="yourascension"
   DB_PASSWORD="123456"
   DB_PORT=1521
   SECRET_KEY="moonshine"
    ```
4. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ `package.json` –∏ —É–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö: `"start": "cross-env NODE_ENV=production nest start"` –∏ `"start:dev": "cross-env NODE_ENV=development nest start --watch"` –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Ñ–∞–π–ª `.env.development`, –∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ `.env.production`.
5. –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª `config.root.ts` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–æ–Ω—Ñ–∏–≥–∞.
    ```TypeScript
   //TypeScript
   //üìÅsrc/common/config.root.ts
   import {ConfigModule} from "@nestjs/config";
   import * as process from "process";
   
   export const configModule =  ConfigModule.forRoot({envFilePath: `.env.${process.env.NODE_ENV}`,
   isGlobal: true})
   ```
<hr/>

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (—Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è –¥–ª—è –ë–î)
1. –° –ø–æ–º–æ—â—å—é __Nest CLI__ —Å–æ–∑–¥–∞–¥–∏–º –º–æ–¥—É–ª—å –¥–ª—è –ë–î. `nest generate module database`;
2. –¢–∞–∫–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª—å __Sequelize__ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:
    ```TypeScript
   //TypeScript
   //üìÅsrc/database/database.module.ts
   import { Module } from '@nestjs/common';
   import {configModule} from "../common/config.root";
   import {SequelizeModule} from "@nestjs/sequelize";
   
   @Module({
        imports: [
        configModule,
        SequelizeModule.forRoot({
            dialect: 'oracle',
            host: process.env.DB_HOST,
            port: Number(process.env.DB_PORT),
            username: process.env.DB_USERNAME,
            password: process.env.DB_PASSWORD,
            database: process.env.DB_DATABASE,
            autoLoadModels: true,
            synchronize: true,
            models: []
        })],
   })
   export class DatabaseModule {}
   ```
3. –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ë–î –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö, –≤ –º–æ–¥—É–ª—å `app.module.ts` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º `database.module.ts`
    ```TypeScript
   //TypeScript
   //üìÅsrc/app.module.ts
    import { Module } from '@nestjs/common';
    import { DatabaseModule } from './database/database.module';
    
    @Module({
        imports: [DatabaseModule],
        controllers: [],
        providers: [],
    })
    export class AppModule {}
   ```
   >üí° –¢.–∫. –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ñ–∏–≥–æ–º –±—ã–ª –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ `database.module.ts`, —Ç–æ –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `app.module.ts`:
    ```TypeScript
   //TypeScript
   //üìÅsrc/main.ts
    import { NestFactory } from '@nestjs/core';
    import { AppModule } from './app.module';
    import * as process from "process";

    async function bootstrap() {
        const PORT = process.env.PORT || 3001
        const app = await NestFactory.create(AppModule);
        await app.listen(PORT, ()=>console.log(`Server has been started on PORT = ${PORT}`));
    }
    bootstrap();
    ```
<hr/>

## –ú–æ–¥—É–ª—å User
### –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è User
1. –° –ø–æ–º–æ—â—å—é __Nest CLI__ —Å–æ–∑–¥–∞—ë–º –º–æ–¥—É–ª—å `nest generate module user`. –û–Ω –ø–æ–∫–∞ —á—Ç–æ –ø—É—Å—Ç.
    ```TypeScript
   //TypeScript
   //üìÅsrc/user/user.module.ts
    import { Module } from '@nestjs/common';
    
    @Module({
        imports: [],
        controllers: [],
        providers: []
    })
    export class UserModule {}
   ```
   >üí° –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–¥—É–ª—è —Å –ø–æ–º–æ—â—å—é __NEST CLI__ –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –≥–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å `app.module.ts`.
    ```TypeScript
    //TypeScript
   //üìÅsrc/app.module.ts

    import { Module } from '@nestjs/common';
    import { DatabaseModule } from './database/database.module';
    import { UserModule } from './user/user.module';
    
    @Module({
        imports: [DatabaseModule, UserModule],
        controllers: [],
        providers: [],
    })
    export class AppModule {}
   ```
### –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ User
1. –°–æ–∑–¥–∞–¥–∏–º –º–æ–¥–µ–ª—å —é–∑–µ—Ä–∞ –¥–ª—è –ë–î –≤ —Ñ–∞–π–ª–µ `user.model.ts`
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.model.ts
    import {Table, Column, Model, PrimaryKey, DataType} from 'sequelize-typescript';
    
    //–°–æ–∑–¥–∞—ë–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –±—É–¥–µ–º —É–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —é–∑–µ—Ä–∞
    interface UserCreationAttribute {
        email: string;
        password: string
    }
    
    @Table({tableName: 'users-nest', timestamps: false})
    export class User extends Model<User, UserCreationAttribute> {
   
        @Column({type: DataType.INTEGER, unique: true, autoIncrement: true, primaryKey: true, allowNull: false})
        id: number;
    
        @Column({type: DataType.STRING, unique: true, allowNull: false})
        email: string;
    
        @Column({type: DataType.STRING, allowNull: false})
        password: string;
    
        @Column({type: DataType.BOOLEAN, defaultValue: false, allowNull: false})
        banned: boolean;
    }
   ```
2. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –µ—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –≤ –∏–º–ø–æ—Ä—Ç–∞—Ö –≤ –º–æ–¥—É–ª–µ `user.module.ts`
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.module.ts
    import { Module } from '@nestjs/common';
    import {SequelizeModule} from "@nestjs/sequelize";
    import {User} from "./user.model";
    
    @Module({
        imports: [SequelizeModule.forFeature([User])],
        controllers: [],
        providers: []
    })
    export class UserModule {}
   ```
3. –¢–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `user.module.ts` –≤ `database.module.ts` –∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ë–î —É–∫–∞–∑–∞—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å:
    ```TypeScript
    //TypeScript
   //üìÅsrc/database/database.module.ts
    import { Module } from '@nestjs/common';
    import {configModule} from "../common/config.root";
    import {SequelizeModule} from "@nestjs/sequelize";
    import {User} from "../user/user.model";
    import {UserModule} from "../user/user.module";
    
    @Module({
        imports: [
        configModule,
        SequelizeModule.forRoot({
            dialect: 'oracle',
            host: process.env.DB_HOST,
            port: Number(process.env.DB_PORT),
            username: process.env.DB_USERNAME,
            password: process.env.DB_PASSWORD,
            database: process.env.DB_DATABASE,
            autoLoadModels: true,
            synchronize: true,
            models: [User]
        }),
        UserModule],
    })
    export class DatabaseModule {}
   ```
### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ User
1. –° –ø–æ–º–æ—â—å—é __Nest CLI__ —Å–æ–∑–¥–∞–¥–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `nest generate controller user`. (–û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—Å—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã `user.module.ts`):
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.controller.ts
    import {Controller, Get} from '@nestjs/common';
    
    @Controller('users')
    export class UserController {
    
        @Get()
         getTest(){
            return 'Test controller getTest()'
        }
    }
   ```
2. –ï—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä, —Ç–æ —É–≤–∏–¥–∏–º —á—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç.
### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ User
1. –° –ø–æ–º–æ—â—å—é __Nest CLI__ —Å–æ–∑–¥–∞–¥–∏–º —Å–µ—Ä–≤–∏—Å `nest generate service user`. (–û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—Å—è –≤ —Å–µ—Ä–≤–∏—Å—ã `user.module.ts`);
2. –° –ø–æ–º–æ—â—å—é `@InjectModel` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –¥–æ–±–∞–≤–∏–º –º–æ–¥–µ–ª—å `User` –∏ –æ–±—ä—è–≤–∏–º –µ—ë –∫–∞–∫ `useRepository`. –ü–æ—Å–ª–µ —á–µ–≥–æ –Ω–∞–ø–∏—à–µ–º –º–µ—Ç–æ–¥ `getAllUsers`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤—Å–µ—Ö —é–∑–µ—Ä–æ–≤:
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.service.ts
    import { Injectable } from '@nestjs/common';
    import {InjectModel} from "@nestjs/sequelize";
    import {User} from "./user.model";
    
    @Injectable()
    export class UserService {
    constructor(@InjectModel(User) private userRepository: typeof User) {}
    
        async getAllUsers(){
            const users = this.userRepository.findAll();
            return users;
        }
    }
   ```
3. –¢.–∫. —Å–µ—Ä–≤–∏—Å —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `user.module.ts`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.module.ts
    import { Module } from '@nestjs/common';
    import {SequelizeModule} from "@nestjs/sequelize";
    import {User} from "./user.model";
    import { UserController } from './user.controller';
    import { UserService } from './user.service';
    
    @Module({
        imports: [SequelizeModule.forFeature([User])],
        controllers: [UserController],
        providers: [UserService]
    })
    export class UserModule {}
   ```
4. –¢–æ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏ —É–∫–∞–∂–µ–º –µ–≥–æ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∫–ª–∞—Å—Å–∞, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤—ã–∑—ã–≤–∞–µ–º —É –Ω–µ–≥–æ –º–µ—Ç–æ–¥ `getAllUsers`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.controller.ts
    import {Controller, Get} from '@nestjs/common';
    import {UserService} from "./user.service";
    
    @Controller('users')
    export class UserController {
    constructor(private readonly userService: UserService) {}
    
        @Get()
        getAllUsers() {
            return this.userService.getAllUsers()
        }
    }
   ```
5. –¢–µ–ø–µ—Ä—å –µ—Å–ª–∏ –º—ã –∑–∞–ø—É—Å—Ç–∏–º —Å–µ—Ä–≤–µ—Ä –∏ –ø–µ—Ä–µ–π–¥—ë–º –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É `localhost:4001/users`, —Ç–æ —É–≤–∏–¥–∏–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —é–∑–µ—Ä–æ–≤ (–¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –∑–∞—Ä–∞–Ω–µ–µ).
6. –í–µ—Ä–Ω—ë–º—Å—è –∫ `user.service.ts` —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —é–∑–µ—Ä–æ–≤. –ú–µ—Ç–æ–¥ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `createUser`, –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç dto:
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.service.ts
    import {Injectable} from "@nestjs/common";
    import {User} from "./user.model";
    import {InjectModel} from "@nestjs/sequelize";
    import {CreateUserDto} from "./dto/create-user.dto";
    
    
    @Injectable()
    export class UserService {
    constructor(@InjectModel(User) private  userRepository: typeof User) {}
    
        async createUser(dto: CreateUserDto){
            const user = await this.userRepository.create(dto)
            return user;
        }
    
        async getAllUsers(){
            const users = await this.userRepository.findAll();
            return users;
        }
    }
   ```
   >üí° __dto__  (__Data-Transfer-Object__) - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–º—É –≤–∏–¥—É.<br> –í –ø–∞–ø–∫–µ user —Å–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É __dto__, –∞ –≤ –Ω–µ–π —Ñ–∞–π–ª `user-create.dto.ts` (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —é–∑–µ—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è):
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/dto/create-user.dto.ts
    export class CreateUserDto {
        readonly email: string;
        readonly password: string;
    }
   ```
7. –°–Ω–æ–≤–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏ —Å–æ–∑–¥–∞—ë–º –º–µ—Ç–æ–¥ `create` —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `@POST` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —é–∑–µ—Ä–∞. –ú–µ—Ç–æ–¥ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@Body` –∏ `userDto`:
    ```TypeScript
    //TypeScript
    //üìÅsrc/user/user.controller.ts
    import {Body, Controller, Get, Post} from '@nestjs/common';
    import {UserService} from "./user.service";
    import {CreateUserDto} from "./dto/create-user.dto";
    
    @Controller('users')
    export class UserController {
    constructor(private readonly userService: UserService) {}
    
        @Post()
        createUser(@Body() userDto: CreateUserDto){
            return this.userService.createUser(userDto)
        }
        @Get()
        getAllUsers() {
            return this.userService.getAllUsers()
        }
    }   
   ```
8. –¢–µ–ø–µ—Ä—å –µ—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏–º —Å–µ—Ä–≤–µ—Ä –∏ –æ—Ç–ø—Ä–∞–≤–∏–º POST –∑–∞–ø—Ä–æ—Å, —Ç–æ —Å–º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å —é–∑–µ—Ä–∞.
<hr/>

## Swagger
### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Swagger
1. –£—Å—Ç–∞–Ω–æ–≤–∏–º __Swagger__ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ `npm install @nestjs/swagger swagger-ui-express`;
2. –í —Ñ–∞–π–ª–µ `main.ts` —Å–æ–∑–¥–∞–¥–∏–º –∫–æ–Ω—Ñ–∏–≥ –∏ —Å–¥–µ–ª–∞–µ–º —Å–µ—Ç–∞–ø –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
    ```TypeScript
    //TypeScript
   //üìÅsrc/main.ts
   import {NestFactory} from '@nestjs/core';
   import {AppModule} from './app.module';
   import * as process from "process";
   import {DocumentBuilder, SwaggerModule} from "@nestjs/swagger";
   
   async function bootstrap() {
   const PORT = process.env.PORT || 3001
   const app = await NestFactory.create(AppModule);
   
       const config = new DocumentBuilder()
           .setTitle('–£—á–µ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ')
           .setDescription('–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API')
           .setVersion('1.0.0')
           .addTag('YourAscension')
           .build();
       //–°–æ–∑–¥–∞—ë–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —É–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–∏–≥
       const document = SwaggerModule.createDocument(app, config)
       //–≠–Ω–¥–ø–æ–∏–Ω—Ç –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–µ–º –Ω–∞–π—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
       SwaggerModule.setup('api/docs', app, document);
       
       await app.listen(PORT, () => console.log(`Server has been started on PORT = ${PORT}`));
   }
   
   bootstrap();
   ```
3. –ü–µ—Ä–µ–π–¥—è –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É `api/docs` —É–≤–∏–¥–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.
### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ User
1. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:
   1. `@ApiTags('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏')` - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞;
   2. `@ApiOperation({summary: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})` -  –Ω–∞–∑–≤–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞;
   3. `@ApiResponse(), @ApiResponse({status: 200, type: User})` - –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞;
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.controller.ts
   import {Body, Controller, Get, Post} from '@nestjs/common';
   import {UserService} from "./user.service";
   import {CreateUserDto} from "./dto/create-user.dto";
   import {ApiTags, ApiOperation, ApiResponse} from "@nestjs/swagger";
   import {User} from "./user.model";
   
   @ApiTags('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏')
   @Controller('users')
   export class UserController {
   constructor(private readonly userService: UserService) {}
   
       @ApiOperation({summary: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
       @ApiResponse({status: 200, type: User})
       @Post()
       createUser(@Body() userDto: CreateUserDto){
           return this.userService.createUser(userDto)
       }
   
       @ApiOperation({summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'})
       @ApiResponse({status: 200, type: [User]})
       @Get()
       getAllUsers() {
           return this.userService.getAllUsers()
       }
   }
   ```
   >‚ö†Ô∏è –ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ç–∞–∫–∂–µ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏.
### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ User –∏ dto
1. –° –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@ApiProperty` –º–æ–∂–Ω–æ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª–±—Ü—ã –º–æ–¥–µ–ª–∏. –£–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è –∏ –µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤:
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.model.ts
       @Table({tableName: 'users-nest', timestamps: false})
        export class User extends Model<User, UserCreationAttribute> {
            @ApiProperty({example: '1', description: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
            @Column({type: DataType.INTEGER, unique: true, autoIncrement: true, primaryKey: true, allowNull: false})
            id: number;
   
            @ApiProperty({example: 'placeholder@gmail.com', description: '–ü–æ—á—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å'})
            @Column({type: DataType.STRING, unique: true, allowNull: false})
            email: string;
   
            @ApiProperty({example: 'qwerty123', description: '–ü–∞—Ä–æ–ª—å'})
            @Column({type: DataType.STRING, allowNull: false})
            password: string;
   
            @ApiProperty({example: 'true', description: '–ó–∞–±–∞–Ω–µ–Ω –ª–∏'})
            @Column({type: DataType.BOOLEAN, defaultValue: false, allowNull: false})
            banned: boolean;
   }
   ```
2. –¢–∞–∫–∂–µ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ–º `create-user.dto.ts`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/dto/create-user.dto.ts
   import {ApiProperty} from "@nestjs/swagger";
   
   export class CreateUserDto {
        @ApiProperty({example: 'placeholder@gmail.com', description: '–ü–æ—á—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å'})
        readonly email: string;
   
        @ApiProperty({example: 'qwerty123', description: '–ü–∞—Ä–æ–ª—å'})
        readonly password: string;
   }
   ```
### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ `addBeareAuth`, –∏ –≤ —Å–µ—Ç–∞–ø–µ —É–∫–∞–∑–∞—Ç—å `{swaggerOptions : {persistAuthorization: true}}`
    ```TypeScript
   //TypeScript
   //üìÅsrc/main.ts
   import {NestFactory} from '@nestjs/core';
   import {AppModule} from './app.module';
   import * as process from "process";
   import {DocumentBuilder, SwaggerModule} from "@nestjs/swagger";
   
   async function bootstrap() {
   const PORT = process.env.PORT || 3001
   const app = await NestFactory.create(AppModule);
   
       const config = new DocumentBuilder()
           .setTitle('–¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ')
           .setDescription('–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API')
           .setVersion('1.0.0')
           .addTag('YourAscension')
           .addBearerAuth()
           .build();
       //–°–æ–∑–¥–∞—ë–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —É–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–∏–≥
       const document = SwaggerModule.createDocument(app, config)
       //–≠–Ω–¥–ø–æ–∏–Ω—Ç –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–µ–º –Ω–∞–π—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
       SwaggerModule.setup('api/docs', app, document, {swaggerOptions : {persistAuthorization: true}});
   
       await app.listen(PORT, () => console.log(`Server has been started on PORT = ${PORT}`));
   }
   
   bootstrap();
   ```
2. –£ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —É –∫–æ—Ç–æ—Ä—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `@UseGuards` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@ApiBearerAuth`, —á—Ç–æ–±—ã –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–º –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
    ```TypeScript
   //TypeScript
   //üìÅsrc/user/user.controller.ts
   import {Body, Controller, Get, Post, UseGuards} from '@nestjs/common';
   import {UserService} from "./user.service";
   import {CreateUserDto} from "./dto/create-user.dto";
   import {ApiBearerAuth, ApiOperation, ApiResponse, ApiTags} from "@nestjs/swagger";
   import {User} from "./user.model";
   import {JwtAuthGuard} from "../auth/jwt-auth.guard";
   
   @ApiTags('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏')
   @Controller('users')
   export class UserController {
   constructor(private readonly userService: UserService) {}
   
       @ApiOperation({summary: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
       @ApiResponse({status: 200, type: User})
       @Post()
       createUser(@Body() userDto: CreateUserDto){
           return this.userService.createUser(userDto)
       }
   
       @ApiOperation({summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'})
       @ApiResponse({status: 200, type: [User]})
       //
       @ApiBearerAuth()
       @UseGuards(JwtAuthGuard)
       @Get()
       getAllUsers() {
           return this.userService.getAllUsers()
       }
   }
   ```
<hr/>

## –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è Roles
–°–æ–∑–¥–∞–¥–∏–º –º–æ–¥—É–ª—å, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, —Å–µ—Ä–≤–∏—Å —Å –ø–æ–º–æ—â—å—é __Nest CLI__. `nest g resource roles`. 
### –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ Roles
1. –°–æ–∑–¥–∞–¥–∏–º –º–æ–¥–µ–ª—å –¥–ª—è —Ä–æ–ª–µ–π `roles.model.ts`:
    ```TypeScript
       //TypeScript
      //üìÅsrc/roles/roles.model.ts
   import {Table, Column, Model, DataType} from 'sequelize-typescript';
   import {ApiProperty} from "@nestjs/swagger";
   
   //–°–æ–∑–¥–∞—ë–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –±—É–¥–µ–º —É–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–æ–ª–∏
   interface RoleCreationAttribute {
   role: string
   }
   
   @Table({tableName: 'roles-nest', timestamps: false})
   export class Roles extends Model<Roles, RoleCreationAttribute> {
        @ApiProperty({example: '1', description: 'ID —Ä–æ–ª–∏'})
        @Column({type: DataType.INTEGER, unique: true, autoIncrement: true, primaryKey: true, allowNull: false})
        id: number;
   
        @ApiProperty({example: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', description: '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏'})
        @Column({type: DataType.STRING, unique: true, allowNull: false})
        role: string;
   }
   ```
2. –¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –º–æ–¥–µ–ª—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ –º–æ–¥—É–ª—é –ë–î –≤ `database.module.ts`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/database/database.module.ts
   import {Module} from '@nestjs/common';
   import {configModule} from "../common/config.root";
   import {SequelizeModule} from "@nestjs/sequelize";
   import {User} from "../user/user.model";
   import {UserModule} from "../user/user.module";
   import {Roles} from "../roles/roles.model";
   
   @Module({
        imports: [
        configModule,
        SequelizeModule.forRoot({
            dialect: 'oracle',
            host: process.env.DB_HOST,
            port: Number(process.env.DB_PORT),
            username: process.env.DB_USERNAME,
            password: process.env.DB_PASSWORD,
            database: process.env.DB_DATABASE,
            autoLoadModels: true,
            synchronize: true,
            models: [User, Roles]
        }),
        UserModule
    ],
   })
   export class DatabaseModule {
   }
   ```
3. –ê —Ç–∞–∫–∂–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –º–æ–¥–µ–ª—å –∫ –º–æ–¥—É–ª—é `roles.module.ts`:
    ```TypeScript
    //TypeScript
   //üìÅsrc//roles/roles.module.ts
   import { Module } from '@nestjs/common';
   import { RolesController } from './roles.controller';
   import { RolesService } from './roles.service';
   import {SequelizeModule} from "@nestjs/sequelize";
   import {Roles} from "./roles.model";
   
   @Module({
        imports: [SequelizeModule.forFeature([Roles])],
        controllers: [RolesController],
        providers: [RolesService]
   })
   export class RolesModule {}
   ```
### –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ –º–æ–¥–µ–ª–µ–π (Roles (1) ‚Üí (‚àû) User)
1. –£ —é–∑–µ—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–¥–Ω–∞ —Ä–æ–ª—å. –¢.–µ. –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å–≤—è–∑—å: __role (1) ‚Üí (‚àû) user__'s. –ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—å, –ø–µ—Ä–µ–π–¥—ë–º –∫ –º–æ–¥–µ–ª–∏ `user.model.ts`:
   1. –°–æ–∑–¥–∞–¥–∏–º —Å—Ç–æ–ª–±–µ—Ü `roleId` –∏ —Å –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ —É–∫–∞–∂–µ–º, —á—Ç–æ –æ–Ω —è–≤–ª—è–µ—Ç—Å—è `ForeignKey` –¥–ª—è –º–æ–¥–µ–ª–∏ `Roles` —Å –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@ForeignKey`;
   2. –° –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@BelongsTo` —Å–æ–∑–¥–∞–¥–∏–º —Å–≤—è–∑—å —Å –º–æ–¥–µ–ª—å—é `Roles`;
    ```TypeScript
    //TypeScript
   //üìÅsrc/user/user.model.ts
   import {Table, Column, Model, PrimaryKey, DataType, BelongsTo, ForeignKey} from 'sequelize-typescript';
   import {ApiProperty} from "@nestjs/swagger";
   import {Role} from "../roles/roles.model";
   
   interface UserCreationAttribute {
        email: string;
        password: string
   }
   
   @Table({tableName: 'users-nest', timestamps: false})
   export class User extends Model<User, UserCreationAttribute> {
        @ApiProperty({example: '1', description: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
        @Column({type: DataType.INTEGER, unique: true, autoIncrement: true, primaryKey: true, allowNull: false})
        id: number;
        @ApiProperty({example: 'placeholder@gmail.com', description: '–ü–æ—á—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å'})
        @Column({type: DataType.STRING, unique: true, allowNull: false})
        email: string;
        @ApiProperty({example: 'qwerty123', description: '–ü–∞—Ä–æ–ª—å'})
        @Column({type: DataType.STRING, allowNull: false})
        password: string;
        @ApiProperty({example: 'true', description: '–ó–∞–±–∞–Ω–µ–Ω –ª–∏'})
        @Column({type: DataType.BOOLEAN, defaultValue: false, allowNull: false})
        banned: boolean;
   
        @ApiProperty({example: '1', description: 'ID —Ä–æ–ª–∏'})
        @ForeignKey(() => Roles,)
        @Column({type: DataType.INTEGER})
        roleId: number
   
        @BelongsTo(() => Roles, {onDelete: 'cascade'})
        roles: Roles
   }
   ```
2. –ê –≤ `roles.model.ts` —É–∫–∞–∂–µ–º, —á—Ç–æ —Ä–æ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —é–∑–µ—Ä–æ–≤ —Å –ø–æ–º–æ—â—å—é `@HasMany(()=>User)users: User[]`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/roles/roles.model.ts
   import {Table, Column, Model, DataType} from 'sequelize-typescript';
   import {ApiProperty} from "@nestjs/swagger";
   import {User} from "../user/user.model";
   
   //–°–æ–∑–¥–∞—ë–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –±—É–¥–µ–º —É–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–æ–ª–∏
   interface RoleCreationAttribute {
        role: string
   }
   
   @Table({tableName: 'roles-nest', timestamps: false})
   export class Roles extends Model<Roles, RoleCreationAttribute> {
        @ApiProperty({example: '1', description: 'ID —Ä–æ–ª–∏'})
        @Column({type: DataType.INTEGER, unique: true, autoIncrement: true, primaryKey: true, allowNull: false})
        id: number;
        @ApiProperty({example: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', description: '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏'})
        @Column({type: DataType.STRING, unique: true, allowNull: false})
        role: string;
   
        @ApiProperty({description: '–û–¥–Ω–∞ —Ä–æ–ª—å –∏–º–µ–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'})
        @HasMany(()=>User)
        users: User[]
   }
   ```
### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è Roles
1. –í —Ñ–∞–π–ª–µ `roles.service.ts` –∑–∞–∏–Ω–∂–µ–∫—Ç–∏–º –º–æ–¥–µ–ª—å `Role` –∏ —Å–æ–∑–¥–∞–¥–∏–º –¥–≤–∞ –º–µ—Ç–æ–¥–∞: `createRole` –∏ `getRoleByValue`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/roles/roles.service.ts
   
   import { Injectable } from '@nestjs/common';
   import {CreateRoleDto} from "./dto/create-role.dto";
   import {InjectModel} from "@nestjs/sequelize";
   import {Roles} from "./roles.model";
   
   @Injectable()
   export class RolesService {
   constructor(@InjectModel(Roles) private roleRepository: typeof Roles) {
   }
   
       async createRole(dto: CreateRoleDto){
           const role = await this.roleRepository.create(dto);
           return role;
       }
   
       async getRoleByValue(value: string) {
           const role = this.roleRepository.findOne({where: {role: value}})
           return role;
       }
   }
   ```
    ```TypeScript
    //TypeScript
   //üìÅsrc/roles/dto/create-role.dto.ts
   import {ApiProperty} from "@nestjs/swagger";
   
   export class CreateRoleDto {
        @ApiProperty({example: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', description: '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏'})
        readonly role: string;
   }
   ```
### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–ª—è Roles
1. –°–æ–∑–¥–∞–¥–∏–º –¥–≤–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞. –í —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ `@Get(‚Äô:/value‚Äô)` —Å –ø–æ–º–æ—â—å—é `URI` –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –¥–æ—Å—Ç–∞—ë–º –∑–Ω–∞—á–µ–Ω–∏–µ `value`:
    ```TypeScript
    //TypeScript
   //üìÅsrc/roles/roles.controller.ts
   
   import {Body, Controller, Post, Get, Param} from '@nestjs/common';
   import {RolesService} from "./roles.service";
   import {CreateRoleDto} from "./dto/create-role.dto";
   
   @Controller('roles')
   export class RolesController {
   constructor(private rolesService: RolesService) {
   }
   
       @Post()
       create(@Body() dto: CreateRoleDto) {
           return this.rolesService.createRole(dto)
       }
   
       @Get('/:value')
       getByName(@Param('value') value: string){
           return this.rolesService.getRoleByValue(value);
       }
   }   
   ```
### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ Roles –∏ User
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –µ–º—É –ø—Ä–∏—Å–≤–∞–∏–≤–∞—Ç—å –∫–∞–∫—É—é-—Ç–æ —Ä–æ–ª—å. –ß—Ç–æ–±—ã –º—ã –∏–º–µ–ª–∏ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å—É `Roles` –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ `User` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ–π—Å—Ç–≤–∏–π:
   1. –í `roles.module.ts` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ `exports` —É–∫–∞–∑–∞—Ç—å `roles.service.ts` (—Ç.–µ. –º—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å):
      ```TypeScript
      //TypeScript
      //üìÅsrc/roles/roles.module.ts
      import { Module } from '@nestjs/common';
      import { RolesController } from './roles.controller';
      import { RolesService } from './roles.service';
      import {SequelizeModule} from "@nestjs/sequelize";
      import {Roles} from "./roles.model";

      @Module({
      imports: [SequelizeModule.forFeature([Roles])],
      controllers: [RolesController],
      providers: [RolesService],
      exports: [RolesService]
      })
      export class RolesModule {}
      ```
   2. –¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ `user.module.ts` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –º–æ–¥—É–ª—å `roles.module.ts`:
      ```TypeScript
      //TypeScript
      //üìÅsrc/user/user.module.ts
      import { Module } from '@nestjs/common';
      import {SequelizeModule} from "@nestjs/sequelize";
      import {User} from "./user.model";
      import { UserController } from './user.controller';
      import { UserService } from './user.service';
      import {RolesModule} from "../roles/roles.module";
   
      @Module({
         imports: [SequelizeModule.forFeature([User]), RolesModule],
         controllers: [UserController],
         providers: [UserService]
      })
      export class UserModule {}
      ```
   3. –ü–æ—Å–ª–µ —á–µ–≥–æ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `RolesService` –≤ `user.service.ts`:
      ```TypeScript
      //TypeScript
      //üìÅsrc/user/user.service.ts
      import { Injectable } from '@nestjs/common';
      import {InjectModel} from "@nestjs/sequelize";
      import {User} from "./user.model";
      import {CreateUserDto} from "./dto/create-user.dto";
      import {RolesService} from "../roles/roles.service";

      @Injectable()
      export class UserService {
      constructor(@InjectModel(User) private userRepository: typeof User, private roleService: RolesService) {}

      async getAllUsers(){
        const users = this.userRepository.findAll();
        return users;
        }

      async createUser(dto: CreateUserDto){
        const user = await this.userRepository.create(dto)
        return user;
        }
      }
      ```
2. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å–æ–∑–¥–∞–¥–∏–º —é–∑–µ—Ä–∞ —Å–¥–µ–ª–∞–µ—Ç `update` –∏ –¥–æ–±–∞–≤–∏–º –µ–º—É —Ä–æ–ª—å:
   ```TypeScript
   //TypeScript
   //üìÅsrc/user/user.service.ts
   import { Injectable } from '@nestjs/common';
   import {InjectModel} from "@nestjs/sequelize";
   import {User} from "./user.model";
   import {CreateUserDto} from "./dto/create-user.dto";
   import {RolesService} from "../roles/roles.service";
   
   @Injectable()
   export class UserService {
      constructor(@InjectModel(User) private userRepository: typeof User, private roleService: RolesService) {}
   
      async getAllUsers(){
         const users = this.userRepository.findAll();
         return users;
      }
   
      async createUser(dto: CreateUserDto){
         const user = await this.userRepository.create(dto)
   
         //–í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º —Ä–æ–ª—å –∫–æ—Ç–æ—Ä–∞—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è USER
         const role = await this.roleService.getRoleByValue('USER');
   
         //–î–µ–ª–∞–µ–º update, –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–≤—è–∑–∏ roles(‚ö†Ô∏è–Ω–µ –∫ —Å—Ç–æ–ª–±—Ü—É roleid) –∏ —É–∫–∞–∑—ã–≤–∞–µ–º id
         await user.$set('roles', role.id);
         return user;
      }
   }
   ```
3. –î–æ–ø–æ–ª–Ω–∏–º –º–µ—Ç–æ–¥ `getAllUsers`. –ï—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å `findAll({include: true;})`, —Ç–æ –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∂–æ–∏–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:
   ```TypeScript
   //TypeScript
   //üìÅsrc/user/user.service.ts
   import { Injectable } from '@nestjs/common';
   import {InjectModel} from "@nestjs/sequelize";
   import {User} from "./user.model";
   import {CreateUserDto} from "./dto/create-user.dto";
   import {RolesService} from "../roles/roles.service";
   
   @Injectable()
   export class UserService {
   constructor(@InjectModel(User) private userRepository: typeof User, private roleService: RolesService) {}
   
       async getAllUsers(){
           const users = this.userRepository.findAll({include: {all: true});
           return users;
       }
   
       async createUser(dto: CreateUserDto){
           const user = await this.userRepository.create(dto)
   
           //–í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º —Ä–æ–ª—å –∫–æ—Ç–æ—Ä–∞—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è USER
           const role = await this.roleService.getRoleByValue('USER');
   
           //–î–µ–ª–∞–µ–º update, –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–≤—è–∑–∏ roles(‚ö†Ô∏è–Ω–µ –∫ —Å—Ç–æ–ª–±—Ü—É roleid) –∏ —É–∫–∞–∑—ã–≤–∞–µ–º id
           await user.$set('roles', role.id);
           user.roles = role; //‚ö†Ô∏è–ö–æ—Å—Ç—ã–ª—å, —á—Ç–æ–±—ã –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç–µ –±—ã–ª–∞ —Ä–æ–ª—å
           return user;
       }
   }
   ```
<hr/>

## –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è Auth
1. –°–æ–∑–¥–∞—ë–º –º–æ–¥—É–ª—å, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏ —Å–µ—Ä–≤–∏—Å —Å –ø–æ–º–æ—â—å—é Nest CLI `nest generate resource auth`.<br> –¢–∞–∫ –∂–µ –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å __JWT__ –∏ __bcryptjs__ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª—è: `npm install @nestjs/jwt bcryptjs`
### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ Auth
1. –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–ª–∞—Å—Å–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∑–∞–∏–Ω–∂–µ–∫—Ç–∏–º `AuthService`, –ø–æ—Å–ª–µ —á–µ–≥–æ —Å–æ–∑–¥–∞–¥–∏–º –¥–≤–∞ POST –º–µ—Ç–æ–¥–∞:
   1) `login(@Body() userDto: **CreateUserDto**)` - –º–µ—Ç–æ–¥ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏;
   2) `registration(@Body() userDto: **CreateUserDto**)` - –º–µ—Ç–æ–¥ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
   ```TypeScript
   //TypeScript
   //üìÅsrc/auth/auth.controller.ts
   import {Controller, Post, Body} from '@nestjs/common';
   import {ApiTags} from "@nestjs/swagger";
   import {CreateUserDto} from "../user/dto/create-user.dto";
   import {AuthService} from "./auth.service";
   
   @ApiTags('–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è')
   @Controller('auth')
   export class AuthController {
        constructor(private authService: AuthService) {
        }
        @Post('/login')
        login(@Body() userDto: CreateUserDto){
        return this.authService.login(userDto);
        }
   
       @Post('/registration')
       registration(@Body() userDto: CreateUserDto){
           return this.authService.registration(userDto);
       }
   }
   ```
### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ Auth
#### –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å—É User –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ Auth
1. –í `auth.service.ts` —Ä–µ–∞–ª–∏–∑—É–µ–º –º–µ—Ç–æ–¥—ã –¥–ª—è **–ª–æ–≥–∏–Ω–∞** –∏ **—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**. –ù—É–∂–Ω–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ —é–∑–µ—Ä–∞–º–∏, –ø–æ—ç—Ç–æ–º—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `user.service.ts`
   1) –í `auth.service.ts` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `userService`:
    ```TypeScript
   //TypeScript
    //üìÅsrc/user/user.service.ts
    import {Injectable} from '@nestjs/common';
    import {CreateUserDto} from "../user/dto/create-user.dto";
    import {UserService} from "../user/user.service";
    
    @Injectable()
    export class AuthService {
        constructor(private userService: UserService) {
        }
    
        async login(userDto: CreateUserDto){
        }
    
        async registration(userDto: CreateUserDto){
        }
    }
    ```
2. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ `auth.module.ts`, –≤ `imports` —É–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥—É–ª—å, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –º–µ—Ç–æ–¥. (–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ `UserService` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `UserModule`, –ø–æ—ç—Ç–æ–º—É –∏–º–ø–æ—Ä–∏—Ç—Ä—É–µ–º –µ–≥–æ):
    ```TypeScript
   //TypeScript
    //üìÅsrc/auth/auth.module.ts
    import { Module } from '@nestjs/common';
    import { AuthService } from './auth.service';
    import { AuthController } from './auth.controller';
    import {UserModule} from "../user/user.module";
    
    @Module({
      providers: [AuthService],
      controllers: [AuthController],
      imports: [UserModule] // <--
    })
    export class AuthModule {}
    ```
3. –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –º–æ–¥—É–ª—é `user.module.ts` –∏ —É–∫–∞–∂–µ–º –≤ `exports` —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å. (–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ `UserService`):
    ```TypeScript
   //TypeScript
    //üìÅsrc/user/user.module.ts
    
    import { Module } from '@nestjs/common';
    import {SequelizeModule} from "@nestjs/sequelize";
    import {User} from "./user.model";
    import { UserController } from './user.controller';
    import { UserService } from './user.service';
    import {RolesModule} from "../roles/roles.module";
    
    @Module({
        imports: [SequelizeModule.forFeature([User]), RolesModule],
        controllers: [UserController],
        providers: [UserService],
        exports: [UserService] // <--
    })
    export class UserModule {}
    ```
#### JWT, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
1. –î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–µ—Ä–µ–π–¥—ë–º –≤ `user.service.ts` –∏ —Ä–µ–∞–ª–∏–∑—É–µ–º –º–µ—Ç–æ–¥ `getUserByEmail`:
    ```TypeScript
   //TypeScript
    //üìÅsrc/user/user.service.ts
    
    import { Injectable } from '@nestjs/common';
    import {InjectModel} from "@nestjs/sequelize";
    import {User} from "./user.model";
    import {CreateUserDto} from "./dto/create-user.dto";
    import {RolesService} from "../roles/roles.service";
    
    @Injectable()
    export class UserService {
        constructor(@InjectModel(User) private userRepository: typeof User, private roleService: RolesService) {}
    
        async getAllUsers(){
            const users = this.userRepository.findAll({include: {all: true}});
            return users;
        }
    
        async createUser(dto: CreateUserDto){
            const user = await this.userRepository.create(dto)
            const role = await this.roleService.getRoleByValue('USER');
            await user.$set('roles', role.id);
            user.roles = role; //‚ö†Ô∏è –ö–æ—Å—Ç—ã–ª—å, —á—Ç–æ–±—ã –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç–µ –±—ã–ª–∞ —Ä–æ–ª—å
            return user;
        }
    
        async getUserByEmail(email: string){
            const user = await this.userRepository.findOne({where: {email: email}, include: {all: true}});
            return user;
        }
    }
    ```
2. –í `auth.module.ts` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º **`JwtModule.register`**, —É–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –∏ —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞:
    ```TypeScript
   //TypeScript
    //üìÅsrc/auth/auth.module.ts
    import { Module } from '@nestjs/common';
    import { AuthService } from './auth.service';
    import { AuthController } from './auth.controller';
    import {UserModule} from "../user/user.module";
    import {JwtModule} from "@nestjs/jwt";
    import * as process from "process";
    import {configModule} from "../common/config.root";
    
    @Module({
      providers: [AuthService],
      controllers: [AuthController],
      imports: [
      configModule,
      UserModule,
      JwtModule.register({
        secret: process.env.SECRET_KEY,
        signOptions: {
          expiresIn: '24h'
        }
      })
      ]
    })
    export class AuthModule {}
    ```
3. –í `auth.service.ts` —Ä–µ–∞–ª–∏–∑—É–µ–º –º–µ—Ç–æ–¥—ã `registration`, `generateToken`, `login`, `validateuser`, `verifyToken`:
   1. `registration(userDto: CreateUserDto)` - –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–æ–π —é–∑–µ—Ä, –µ—Å–ª–∏ –Ω–µ—Ç, —Ç–æ —Ö—ç—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å –∏ —Å–æ–∑–¥–∞—ë–º –µ–≥–æ, –∞ —Ç–∞–∫–∂–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω;
   2. `generateToken(user: User)` - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω;
   3. `login(userDto: CreateUserDto)` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω;
   4. `validateUser(userDto: CreateUserDto)` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–æ–π —é–∑–µ—Ä –≤ –ë–î, –∑–∞—Ç–µ–º —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–∞—Ä–æ–ª–∏;
   5. `verifyToken(authHeader)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞;

    ```TypeScript
   //TypeScript
    //üìÅsrc/auth/auth.service.ts
    
    import {HttpException, HttpStatus, Injectable, UnauthorizedException} from '@nestjs/common';
    import {CreateUserDto} from "../user/dto/create-user.dto";
    import {UserService} from "../user/user.service";
    import {JwtService} from "@nestjs/jwt";
    import * as bcrypt from 'bcryptjs'
    import {User} from "../user/user.model";
    
    @Injectable()
    export class AuthService {
        constructor(private userService: UserService, private jwtService: JwtService) {
        }
    
        async login(userDto: CreateUserDto){
            const user = await this.validateUser(userDto);
            return this.generateToken(user)
        }
    
        async registration(userDto: CreateUserDto){
            const candidate = await this.userService.getUserByEmail(userDto.email);
            if (candidate){
                throw new HttpException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', HttpStatus.BAD_REQUEST)
            }
            const hashPassword =await bcrypt.hash(userDto.password, 5);
            const user = await this.userService.createUser({...userDto, password: hashPassword})
            return this.generateToken(user)
        }
    
        private async generateToken(user: User) {
            const payload = {email: user.email, id: user.id, role: user.roles}
            return {
                token: this.jwtService.sign(payload)
            }
        }
    
        private async validateUser(userDto: CreateUserDto) {
            const user = await this.userService.getUserByEmail(userDto.email)
    
            if (user){
                const passwordEquals = await bcrypt.compare(userDto.password, user.password)
                if (passwordEquals){
                    return user
                }
            }
            throw new UnauthorizedException({message: '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å'})
        }
   	verifyToken(authHeader: string){
	        try {
	            //–í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º Authorization –∏–∑ header –∑–∞–ø—Ä–æ—Å–∞
	            const bearer = authHeader.split(' ')[0]
	            const token = authHeader.split(' ')[1]
	            //–ï—Å–ª–∏ —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞ –Ω–µ Bearer –∏–ª–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç, —Ç–æ –æ—à–∏–±–∫–∞
	            if (bearer !=='Bearer' || !token){
	                throw new UnauthorizedException({message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'})
	            }
	            //–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π, —Ç–æ –æ—à–∏–±–∫–∞, –µ—Å–ª–∏ –≤–∞–ª–∏–¥–Ω—ã–π - –¥–∞–Ω–Ω—ã–µ.
	            return this.jwtService.verify(token);
	        }
	        catch (e) {
	            throw new UnauthorizedException({message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'})
	        }
	    }
    }
    ```
### –°–æ–∑–¥–∞–Ω–∏–µ Guard –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
–ë–ª–∞–≥–æ–¥–∞—Ä—è –≥–≤–∞—Ä–¥–∞–º –º–æ–∂–Ω–æ –∑–∞–ø—Ä–µ—â–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º –ø–æ –∫–∞–∫–æ–º—É-–ª–∏–±–æ —É—Å–ª–æ–≤–∏—é.
1. –í –ø–∞–ø–∫–µ `auth` —Å–æ–∑–¥–∞–¥–∏–º –≥–≤–∞—Ä–¥ `jwt-auth.guard.ts`. –ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–Ω–∂–µ–∫—Ç–∏—Ä—É–µ–º—ã–º (–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@Injectable`). –¢–∞–∫–∂–µ —ç—Ç–æ—Ç –∫–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `CanActivate`. –í –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `context`. –°—É—Ç—å —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ç–æ–º, —á—Ç–æ –∫–æ–≥–¥–∞ –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false` - –¥–æ—Å—Ç—É–ø **–∑–∞–ø—Ä–µ—â—ë–Ω**, `true` - **—Ä–∞–∑—Ä–µ—à—ë–Ω**.
    ```TypeScript
   //TypeScript
    //üìÅsrc/auth/jwt-auth.guard.ts
   import {CanActivate, ExecutionContext, Injectable} from "@nestjs/common";
   import {Observable} from "rxjs";
   import {AuthService} from "./auth.service";
   
   @Injectable()
   export class JwtAuthGuard implements CanActivate {
        constructor(private authService: AuthService) {
        }
        canActivate(context: ExecutionContext): boolean | Promise<boolean> | Observable<boolean> {
            const request = context.switchToHttp().getRequest()
            const autHeader = request.headers.authorization;
            return this.authService.verifyToken(autHeader)
        }
   }
    ```
2. –ò–∑ `auth.module.ts` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º `AuthService` (—Ç.–∫. –≤ –ì–≤–∞—Ä–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å –∏–∑ —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è):
   <br>
   >‚ö†Ô∏è–ù–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–π `@Guard` –≤ –º–æ–¥—É–ª–µ `User`. –¢.–∫. –º–æ–¥—É–ª–∏ `Auth` –∏ `User` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–µ, —Ç–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∫–æ–ª—å—Ü–µ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å. –ß—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç—É –æ—à–∏–±–∫—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –º–æ–¥—É–ª—å `Auth` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `User` —Å –ø–æ–º–æ—â—å—é `forwardRef`: `forwardRef(()=>UserModule)`
    ```TypeScript
   //TypeScript
    //üìÅsrc/auth/auth.module.ts
    
    import {Module} from '@nestjs/common';
    import { AuthService } from './auth.service';
    import { AuthController } from './auth.controller';
    import {UserModule} from "../user/user.module";
    import {JwtModule} from "@nestjs/jwt";
    import * as process from "process";
    import {configModule} from "../common/config.root";
    
    @Module({
      providers: [AuthService],
      controllers: [AuthController],
      imports: [
      configModule,
      //–î–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–ª—å—Ü–µ–≤–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é
      forwardRef(()=>UserModule),
      JwtModule.register({
        secret: process.env.SECRET_KEY,
        signOptions: {
          expiresIn: '24h'
        }
      })
      ],
      //–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º 
      exports: [
          AuthService,
      ]
    })
    export class AuthModule {}
    ```
3. `@Guard` –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –º–æ–¥—É–ª–µ `User`. –ö–∞–∫ –±—ã–ª–æ —Å–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ, –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏ –æ–±—Ä–∞–∑—É–µ—Ç—Å—è –∫–æ–ª—å—Ü–µ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –ø–æ—ç—Ç–æ–º—É `AuthModule` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –º–æ–¥—É–ª—å `User` —Å –ø–æ–º–æ—â—å—é `forwardRef`: `forwardRef(()=>AuthModule)`:
    ```TypeScript
   //TypeScript
    //üìÅsrc/user/user.module.ts
    import {forwardRef, Module} from '@nestjs/common';
    import {SequelizeModule} from "@nestjs/sequelize";
    import {User} from "./user.model";
    import { UserController } from './user.controller';
    import { UserService } from './user.service';
    import {RolesModule} from "../roles/roles.module";
    import {AuthModule} from "../auth/auth.module";
    
    @Module({
        imports: [
            SequelizeModule.forFeature([User]),
            RolesModule,
    		//–î–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–ª—å—Ü–µ–≤–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
            forwardRef(()=>AuthModule),
        ],
        controllers: [UserController],
        providers: [UserService],
        exports: [UserService]
    })
    export class UserModule {}
    ```
   >üí° –¢.–µ. –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª–∏ –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —ç—Ç–æ –¥–µ–ª–∞—Ç—å —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ `forwardRef`.
4. –ü–µ—Ä–µ–π–¥—ë–º –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É `user.controller.ts`, –º–µ—Ç–æ–¥—É `getAllUsers` –¥–æ–±–∞–≤–∏–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@UseGuards`, –∫–æ—Ç–æ—Ä—ã–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π `JwtAuthGuard`:
    ```TypeScript
    //TypeScript
    //üìÅsrc/user/user.controller.ts
    
    import {Body, Controller, Get, Post, UseGuards} from '@nestjs/common';
    import {UserService} from "./user.service";
    import {CreateUserDto} from "./dto/create-user.dto";
    import {ApiOperation, ApiResponse, ApiTags} from "@nestjs/swagger";
    import {User} from "./user.model";
    import {JwtAuthGuard} from "../auth/jwt-auth.guard";
    
    @ApiTags('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏')
    @Controller('users')
    export class UserController {
        constructor(private readonly userService: UserService) {}
    
        @ApiOperation({summary: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
        @ApiResponse({status: 200, type: User})
        @Post()
        createUser(@Body() userDto: CreateUserDto){
            return this.userService.createUser(userDto)
        }
    
        @ApiOperation({summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'})
        @ApiResponse({status: 200, type: [User]})
        //–ì–≤–∞—Ä–¥
        @UseGuards(JwtAuthGuard)
        @Get()
        getAllUsers() {
            return this.userService.getAllUsers()
        }
    }
    ```
5. –¢–µ–ø–µ—Ä—å –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É `localhost:4001/users` —Å –º–µ—Ç–æ–¥–æ–º GET –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ `Headers` —É–∫–∞–∑—ã–≤–∞—Ç—å `Authorization` c —Ç–æ–∫–µ–Ω–æ–º.
### Roles Guard –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
1. –°–æ–∑–¥–∞–¥–∏–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `roles-auth.decorator.ts`. `ROLE_KEY` - –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –º—ã —Å–º–æ–∂–µ–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—É –∏–∑ –ì–≤–∞—Ä–¥–∞:
    ```TypeScript
    //TypeScript
    //üìÅsrc/auth/roles-auth.decorator.ts
    
    import {SetMetadata} from "@nestjs/common";
    
    export const ROLE_KEY = 'role'
    
    //–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —Å —Ä–æ–ª—å—é
    export const Role = (role: string)=> SetMetadata(ROLE_KEY, role)
    ```
2. –°–æ–∑–¥–∞–¥–∏–º –≥–≤–∞—Ä–¥ `roles-guard.ts`. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `ROLE_KEY`, –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤—ã—Ç–∞—â–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ. –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∫–ª–∞—Å—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å `private reflector: Reflector`. –° –ø–æ–º–æ—â—å—é –Ω–µ–≥–æ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –º–æ–∂–µ–º –≤—ã—Ç–∞—â–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–µ—Ä–µ–¥–∞–¥–∏–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—É –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤:
    ```TypeScript
    //TypeScript
    //üìÅsrc/auth/roles-guard.ts
    
    import {CanActivate, ExecutionContext, ForbiddenException, Injectable} from "@nestjs/common";
    import {Reflector} from "@nestjs/core";
    import {ROLE_KEY} from "./roles-auth.decorator";
    import {UserService} from "../user/user.service";
    import {AuthService} from "./auth.service";
    
    @Injectable()
    export class RolesGuard implements CanActivate {
        constructor(private authService: AuthService, private userService: UserService, private reflector: Reflector) {
        }
    
        async canActivate(context: ExecutionContext): Promise<boolean> {
    		//–° –ø–æ–º–æ—â—å—é –∫–ª—é—á–∞ –∏ —Ä–µ—Ñ–ª–µ–∫—Ç–æ—Ä–∞ –¥–æ—Å—Ç–∞—ë–º –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–µ—Ä–µ–¥–∞–¥–∏–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—É –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
            const requiredRole = this.reflector.getAllAndOverride(ROLE_KEY, [context.getHandler(), context.getClass()])
    
            if (!requiredRole) {
                return true;
            }
    
            const request = context.switchToHttp().getRequest();
            //–í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º Authorization –∏–∑ header –∑–∞–ø—Ä–æ—Å–∞
            const authHeader = request.headers.authorization;
    		//–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
            const user = this.authService.verifyToken(authHeader)
    		//–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ –ë–î, –µ—Å—Ç—å –ª–∏ —É —Ç–∞–∫–æ–≥–æ —é–∑–µ—Ä–∞ —Ç—Ä–µ–±—É–µ–º–∞—è —Ä–æ–ª—å
            const accessIsAllowed = await this.userService.verifyUserRole(user.email, requiredRole)
    
            if (!accessIsAllowed) {
                throw new ForbiddenException({message: '–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω'})
            }
            return true;
        }
    }
    ```
3. –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ —É —é–∑–µ—Ä–∞ —Ç–∞–∫–∞—è —Ä–æ–ª—å, –≤ –≤ `user.service.ts` –¥–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥ `verifyUserRole(email: string, neededRole: string)`:
    ```TypeScript
    //TypeScript
    //üìÅsrc/user/user.service.ts
    import { Injectable } from '@nestjs/common';
    import {InjectModel} from "@nestjs/sequelize";
    import {User} from "./user.model";
    import {CreateUserDto} from "./dto/create-user.dto";
    import {RolesService} from "../roles/roles.service";
    import {Roles} from "../roles/roles.model";
    
    @Injectable()
    export class UserService {
        constructor(@InjectModel(User) private userRepository: typeof User, private roleService: RolesService) {}
    
        async getAllUsers(){
            const users = this.userRepository.findAll({include: {all: true}});
            return users;
        }
    
        async createUser(dto: CreateUserDto){
            const user = await this.userRepository.create(dto)
            const role = await this.roleService.getRoleByValue('USER');
            await user.$set('roles', role.id);
            user.roles = role; //–ö–æ—Å—Ç—ã–ª—å, —á—Ç–æ–±—ã –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç–µ –±—ã–ª–∞ —Ä–æ–ª—å
            return user;
        }
    
        async getUserByEmail(email: string){
            const user = await this.userRepository.findOne({where: {email: email}, include: {all: true}});
            return user;
        }
    
        async verifyUserRole(email: string, neededRole: string){
            return await this.userRepository.findOne({where: {email: email}, include: { model: Roles, required: true, where: {role: neededRole}}})
        }
    }
    ```
4. –ü–µ—Ä–µ–π–¥—ë–º –≤ `user.controller.ts`, –∏ —É—Å—Ç–∞–Ω–æ–≤–∏–º –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –≥–≤–∞—Ä–¥ –∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –º–µ—Ç–æ–¥–∞ `getAllUsers`. –° –ø–æ–º–æ—â—å—é `@Role` - —É–∫–∞–∂–µ–º –¥–ª—è –∫–∞–∫–æ–π —Ä–æ–ª–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç. –ü–æ—Å–ª–µ —á–µ–≥–æ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞—à –≥–≤–∞—Ä–¥ —Å –ø–æ–º–æ—â—å—é `@UseGuards(RolesGuard)`:
    ```TypeScript
    //TypeScript
    //üìÅsrc/user/user.controller.ts
    
    import {Body, Controller, Get, Post, UseGuards} from '@nestjs/common';
    import {UserService} from "./user.service";
    import {CreateUserDto} from "./dto/create-user.dto";
    import {ApiBearerAuth, ApiOperation, ApiResponse, ApiTags} from "@nestjs/swagger";
    import {User} from "./user.model";
    import {JwtAuthGuard} from "../auth/jwt-auth.guard";
    import {Role} from "../auth/roles-auth.decorator";
    import {RolesGuard} from "../auth/roles.guard";
    
    @ApiTags('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏')
    @Controller('users')
    export class UserController {
        constructor(private readonly userService: UserService) {
        }
    
        @ApiOperation({summary: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
        @ApiResponse({status: 200, type: User})
        @Post()
        createUser(@Body() userDto: CreateUserDto) {
            return this.userService.createUser(userDto)
        }
    
        @ApiOperation({summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'})
        @ApiResponse({status: 200, type: [User]})
        @ApiBearerAuth()
        //@UseGuards(JwtAuthGuard)
        @Role('ADMIN')
        @UseGuards(RolesGuard)
        @Get()
        getAllUsers() {
            return this.userService.getAllUsers()
        }
    }
    ```
### –†–∞–∑–¥–∞—á–∞ —Ä–æ–ª–µ–π –∏ –±–∞–Ω–æ–≤
1. –í `user.controller.ts` —Å–æ–∑–¥–∞–¥–∏–º 2 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ **POST** –∑–∞–ø—Ä–æ—Å–∞–º–∏: `‚Äò/role‚Äô` –∏ ‚Äò`/ban‚Äô`:
    ```TypeScript
    //TypeScript
    //üìÅsrc/user/user.controller.ts
    
    import {Body, Controller, Get, Post, UseGuards} from '@nestjs/common';
    import {UserService} from "./user.service";
    import {CreateUserDto} from "./dto/create-user.dto";
    import {ApiBearerAuth, ApiOperation, ApiResponse, ApiTags} from "@nestjs/swagger";
    import {User} from "./user.model";
    import {JwtAuthGuard} from "../auth/jwt-auth.guard";
    import {Role} from "../auth/roles-auth.decorator";
    import {RolesGuard} from "../auth/roles.guard";
    import {AddRoleDto} from "./dto/add-role.dto";
    import {BanUserDto} from "./dto/ban-user.dto";
    
    @ApiTags('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏')
    @Controller('users')
    export class UserController {
        constructor(private readonly userService: UserService) {
        }
    
        @ApiOperation({summary: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
        @ApiResponse({status: 200, type: User})
        @Post()
        createUser(@Body() userDto: CreateUserDto) {
            return this.userService.createUser(userDto)
        }
    
        @ApiOperation({summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'})
        @ApiResponse({status: 200, type: [User]})
        @ApiBearerAuth()
        @UseGuards(JwtAuthGuard)
        @Role('ADMIN')
        @UseGuards(RolesGuard)
        @Get()
        getAllUsers() {
            return this.userService.getAllUsers()
        }
    
        @ApiOperation({summary: '–í—ã–¥–∞—Ç—å —Ä–æ–ª—å'})
        @ApiResponse({status: 200})
        @ApiBearerAuth()
        @UseGuards(JwtAuthGuard)
        @Role('ADMIN')
        @UseGuards(RolesGuard)
        @Post('/role')
        addRole(@Body() dto: AddRoleDto) {
            return this.userService.addRole(dto)
        }
        @ApiOperation({summary: '–ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
        @ApiResponse({status: 200})
        @ApiBearerAuth()
        @UseGuards(JwtAuthGuard)
        @Role('ADMIN')
        @UseGuards(RolesGuard)
        @Post('/ban')
        ban(@Body() dto: BanUserDto) {
            return this.userService.ban(dto)
        }
    }
    ```
2. –°–æ–∑–¥–∞–¥–∏–º 2 dto:
    ```TypeScript
    //TypeScript
    //üìÅsrc/user/dto/add-role.dto.ts
    
    import {ApiProperty} from "@nestjs/swagger";
    
    export class AddRoleDto {
        @ApiProperty({example: 'USER', description: '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏'})
        readonly value: string;
        @ApiProperty({example: 1, description: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
        readonly userId: number;
    }
    ```
    ```TypeScript
    //TypeScript
    //üìÅsrc/user/dto/ban-user.dto.ts
    
    import {ApiProperty} from "@nestjs/swagger";
    
    export class BanUserDto {
        @ApiProperty({example: 1, description: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
        readonly userId: number;
    }
    ```
3. –í `user.service.ts` —Å–æ–∑–¥–∞–¥–∏–º –º–µ—Ç–æ–¥—ã `addRole(dto: AddRoleDto)` –∏ `ban(dto: BanUserDto)`:
    ```TypeScript
     //TypeScript
    //üìÅsrc/user/dto/user.service.ts
    
    import {HttpException, HttpStatus, Injectable} from '@nestjs/common';
    import {InjectModel} from "@nestjs/sequelize";
    import {User} from "./user.model";
    import {CreateUserDto} from "./dto/create-user.dto";
    import {RolesService} from "../roles/roles.service";
    import {Roles} from "../roles/roles.model";
    import {AddRoleDto} from "./dto/add-role.dto";
    import {BanUserDto} from "./dto/ban-user.dto";
    
    @Injectable()
    export class UserService {
        constructor(@InjectModel(User) private userRepository: typeof User, private roleService: RolesService) {
        }
    
        async getAllUsers() {
            const users = this.userRepository.findAll({include: {all: true}});
            return users;
        }
    
        async createUser(dto: CreateUserDto) {
            const user = await this.userRepository.create(dto)
            const role = await this.roleService.getRoleByValue('USER');
            await user.$set('roles', role.id);
            user.roles = role; //–ö–æ—Å—Ç—ã–ª—å, —á—Ç–æ–±—ã –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç–µ –±—ã–ª–∞ —Ä–æ–ª—å
            return user;
        }
    
        async getUserByEmail(email: string) {
            const user = await this.userRepository.findOne({where: {email: email}, include: {all: true}});
            return user;
        }
    
        async verifyUserRole(email: string, neededRole: string) {
            return await this.userRepository.findOne({
                where: {email: email},
                include: {model: Roles, required: true, where: {role: neededRole}}
            })
        }
    
        async addRole(dto: AddRoleDto) {
            const user = await this.userRepository.findByPk(dto.userId);
            const role = await this.roleService.getRoleByValue(dto.value);
            if (role && user) {
                console.log(role.id)
                await user.update({roleId: role.id})
                return
            }
            throw new HttpException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ —Ä–æ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', HttpStatus.NOT_FOUND)
    
        }
    
        async ban(dto: BanUserDto) {
            const user = await this.userRepository.findByPk(dto.userId);
            if (user) {
                user.banned = true;
                await user.save();
                return
            }
            throw new HttpException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', HttpStatus.NOT_FOUND)
        }
    }
    ```
<hr/>

## –í–∞–ª–∏–¥–∞—Ü–∏—è. Pipes –∏ class-validator
1. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 2 NPM –ø–∞–∫–µ—Ç–∞ - **class-validator** –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ **class-transformer** –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. `npm install class-validator class-transformer`;
2. –†–µ–∞–ª–∏–∑—É–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è `create-user.dto.ts`. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ **class-validator** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ (–ø—Ä–∏–º–µ—Ä: `@IsEmail`, `@IsString` –∏ —Ç.–¥.):
    ```TypeScript
    //TypeScript
    //üìÅsrc/user/dto/create-user.dto.ts
    
    import {ApiProperty} from "@nestjs/swagger";
    import {IsEmail, IsString, Length} from "class-validator";
    
    export class CreateUserDto {
        @ApiProperty({example: 'test666@gmail.com', description: '–ü–æ—á—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å'})
        @IsString({message: '–î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π'})
        @IsEmail({}, {message: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email'})
        readonly email: string;
    
        @ApiProperty({example: 'qwerty', description: '–ü–∞—Ä–æ–ª—å'})
        @IsString({message: '–î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π'})
        @Length(6, 12, {message: '–ù–µ –º–µ–Ω—å—à–µ 6 –∏ –Ω–µ –±–æ–ª—å—à–µ 12'} )
        readonly password: string;
    
        @ApiProperty({example: '1', description: 'ID —Ä–æ–ª–∏'})
        readonly roleId: number;
    }
    
    ```
3. –ü–∞–π–ø—ã –∏–º–µ—é—Ç 2 –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö;
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
4. –°–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É `pipes` –∏ —Ñ–∞–π–ª `validation.pipe.ts`. –≠—Ç–æ –±—É–¥–µ—Ç `@Injectable` –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `PipeTransform`. –í–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞ –µ—Å—Ç—å –º–µ—Ç–æ–¥ `transform` —Å 2 –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏:
   1. `value` - –≤—Ö–æ–¥—è—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–¥–æ–ø—É—Å—Ç–∏–º `{ email: 'test666', password: 'qwerty', roleId: 'asdasd' }` )
   2. `metadata` - —Ç—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∫–∞–∫–æ–µ dto –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏ –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–ø—Ä–æ—Å–µ (–ø—Ä–∏–º–µ—Ä: `{ metatype: [class CreateUserDto], type: 'body', data: undefined }` )
    ```TypeScript
    //TypeScript
    //üìÅsrc/user/pipes/validation.pipe.ts
    
    import {ArgumentMetadata, Injectable, PipeTransform} from "@nestjs/common";
    import {plainToClass} from "class-transformer";
    import {validate, ValidationError} from "class-validator";
    import {ValidationException} from "../exceptions/validation.exception";
    
    type FormattedValidationErrorType = {
        field: string;
        message: string;
    }
    
    @Injectable()
    export class ValidationPipe<T> implements PipeTransform<T> {
        async transform<T>(value: T, metadata: ArgumentMetadata): Promise<T | never> {
    				
    				//–° –ø–æ–º–æ—â—å—é plainToClass –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é dto –∏–∑ metadata.metatype
    				//–ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è obj: CreateUserDto { email: 'test666', password: 12, roleId: 'asdasd' }
            const obj: ValidationError = plainToClass(metadata.metatype, value)
            const errors: ValidationError[] = await validate(obj)
    
            if (errors.length) {
    
                const validationErrors: FormattedValidationErrorType[] = errors.reduce((acc: FormattedValidationErrorType[], validationError: ValidationError) => {
                    Object.values(validationError.constraints).forEach(constraint => {
                        const field = validationError.property;
                        const message = constraint;
                        acc.push({field, message})
                    })
    
                    return acc
                }, [])
    
                throw new ValidationException(validationErrors)
            }
            return value;
        }
    }
    ```
5. –°–æ–∑–¥–∞–¥–∏–º —Å–≤–æ–π –∫–ª–∞—Å—Å –¥–ª—è –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ `validation.exception.ts` –≤ –ø–∞–ø–∫–µ `exceptions`:
    ```TypeScript
    //TypeScript
    //üìÅsrc/exceptions/validation.exception.ts
    
    import {HttpException, HttpStatus} from "@nestjs/common";
    
    export class ValidationException extends HttpException {
        constructor(validationErrors) {
            super({status: HttpStatus.BAD_REQUEST, validationErrors, message: '–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏'}, HttpStatus.BAD_REQUEST);
        }
    }
    ```
6. –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞–π–ø `ValidationPipe` –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ `user.controller.ts` —É –º–µ—Ç–æ–¥–∞ `createUser`. –° –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@UsePipe`:
    ```TypeScript
    //TypeScript
    //üìÅsrc/user/user.controller.ts
    
    import {Body, Controller, Get, Post, UseGuards, UsePipes} from '@nestjs/common';
    import {UserService} from "./user.service";
    import {CreateUserDto} from "./dto/create-user.dto";
    import {ApiBearerAuth, ApiOperation, ApiResponse, ApiTags} from "@nestjs/swagger";
    import {User} from "./user.model";
    import {JwtAuthGuard} from "../auth/jwt-auth.guard";
    import {Role} from "../auth/roles-auth.decorator";
    import {RolesGuard} from "../auth/roles.guard";
    import {AddRoleDto} from "./dto/add-role.dto";
    import {BanUserDto} from "./dto/ban-user.dto";
    import {ValidationPipe} from "../pipes/validation.pipe";
    
    @ApiTags('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏')
    @Controller('users')
    export class UserController {
        constructor(private readonly userService: UserService) {
        }
    
        @ApiOperation({summary: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
        @ApiResponse({status: 200, type: User})
        @UsePipes(ValidationPipe)
        @Post()
        createUser(@Body() userDto: CreateUserDto) {
            return this.userService.createUser(userDto)
        }
    
        @ApiOperation({summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'})
        @ApiResponse({status: 200, type: [User]})
        @ApiBearerAuth()
        @UseGuards(JwtAuthGuard)
        @Role('ADMIN')
        @UseGuards(RolesGuard)
        @Get()
        getAllUsers() {
            return this.userService.getAllUsers()
        }
    
        @ApiOperation({summary: '–í—ã–¥–∞—Ç—å —Ä–æ–ª—å'})
        @ApiResponse({status: 200})
        @ApiBearerAuth()
        @UseGuards(JwtAuthGuard)
        @Role('ADMIN')
        @UseGuards(RolesGuard)
        @Post('/role')
        addRole(@Body() dto: AddRoleDto) {
            return this.userService.addRole(dto)
        }
        @ApiOperation({summary: '–ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})
        @ApiResponse({status: 200})
        @ApiBearerAuth()
        @UseGuards(JwtAuthGuard)
        @Role('ADMIN')
        @UseGuards(RolesGuard)
        @Post('/ban')
        ban(@Body() dto: BanUserDto) {
            return this.userService.ban(dto)
        }
    }
    ```
–¢–µ–ø–µ—Ä—å –µ—Å–ª–∏ –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–æ–π–¥—É—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é, —Ç–æ –º—ã –ø–æ–ª—É—á–∏–º –≤–æ—Ç —Ç–∞–∫–æ–π **–æ—Ç–≤–µ—Ç**:
    ```json
   //JSON
    {
      "status": 400,
      "validationErrors": [
        {
          "field": "email",
          "message": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email"
        },
        {
          "field": "password",
          "message": "–ù–µ –º–µ–Ω—å—à–µ 6 –∏ –Ω–µ –±–æ–ª—å—à–µ 12"
        },
        {
          "field": "password",
          "message": "–î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π"
        }
      ],
      "message": "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏"
    }
    ```
<hr/>

## –ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è pipe –æ—Ç middleware –≤ NestJS
–í NestJS middleware –∏ pipes - —ç—Ç–æ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–∞, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ HTTP –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

**Middleware** - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∏–ª–∏ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ HTTP. –û–Ω–∏ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —Ç.–¥. Middleware –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–ª—É—á–∞–µ—Ç —Ç—Ä–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞: –æ–±—ä–µ–∫—Ç –∑–∞–ø—Ä–æ—Å–∞, –æ–±—ä–µ–∫—Ç –æ—Ç–≤–µ—Ç–∞ –∏ —Ñ—É–Ω–∫—Ü–∏—é¬†`next()`. Middleware –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –æ–±—ä–µ–∫—Ç –∑–∞–ø—Ä–æ—Å–∞ –∏–ª–∏ –æ—Ç–≤–µ—Ç–∞, –∞ —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–º—É middleware –≤ —Ü–µ–ø–æ—á–∫–µ –≤—ã–∑–æ–≤–æ–≤ —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏¬†`next()`. Middleware –º–æ–∂–µ—Ç –±—ã—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–º (–¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–º (–¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞).

**Pipes** - —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –∑–∞–ø—Ä–æ—Å–µ HTTP. –û–Ω–∏ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ç.–¥. Pipe –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–æ–º¬†`transform()`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏. Pipes –º–æ–≥—É—Ç –±—ã—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ (–¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ (–¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞).

–ì–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ –º–µ–∂–¥—É middleware –∏ pipes –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ middleware –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã HTTP –≤ —Ü–µ–ª–æ–º, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ pipes –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–ø—Ä–æ—Å–µ HTTP. Middleware –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á, –≤–∫–ª—é—á–∞—è –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ —Ç.–¥. Pipes, —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –∑–∞–ø—Ä–æ—Å–µ HTTP.

–í —Ü–µ–ª–æ–º, middleware –∏ pipes - —ç—Ç–æ –º–æ—â–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–∏–±–∫–∏–µ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ NestJS. –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
<hr/>

## –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π Posts –∏ Files
1. –°–æ–∑–¥–∞–¥–∏–º –º–æ–¥—É–ª–∏ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `nest g resource posts` –∏ `nest g resource files`.
### –ú–æ–¥—É–ª—å Posts
1. –°–æ–∑–¥–∞–¥–∏–º –º–æ–¥–µ–ª—å `posts.model.ts`:
    ```TypeScript
    //TypeScript
    //üìÅsrc/posts/posts.model.ts
    
    import {Table, Column, Model, DataType, BelongsTo, ForeignKey} from 'sequelize-typescript';
    import {User} from "../user/user.model";
    
    interface PostsCreationAttribute {
        email: string;
        password: string;
        userId: number;
        image: string;
    }
    
    @Table({tableName: 'posts-nest', timestamps: false})
    export class Posts extends Model<Posts, PostsCreationAttribute> {
        @Column({type: DataType.INTEGER, unique: true, autoIncrement: true, primaryKey: true, allowNull: false})
        id: number;
        @Column({type: DataType.STRING, unique: true, allowNull: false})
        title: string;
        @Column({type: DataType.STRING, allowNull: false})
        content: string;
        @Column({type: DataType.STRING})
        image: string;
    
        @ForeignKey(() => User, )
        @Column({type: DataType.INTEGER})
        userId: number
    
        @BelongsTo(() => User, { onDelete: 'cascade'})
        users: User
    }
    ```
2. –í –º–æ–¥–µ–ª–∏ `user.model.ts` —É–∫–∞–∂–µ–º `@HasMany(()=>Posts)posts: Posts[]`;
3. –í —Ñ–∞–π–ª–µ –º–æ–¥—É–ª—è `posts.module.ts` –≤ –∏–º–ø–æ—Ä—Ç–µ —É–∫–∞–∂–µ–º `SequelizeModule.forFeature([Posts])`;
4. –í —Ñ–∞–π–ª–µ –º–æ–¥—É–ª—è `database.module.ts` –≤ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è **Sequelize** –≤ –º–∞—Å—Å–∏–≤ `models` –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å `Posts`;
5. –°–æ–∑–¥–∞–¥–∏–º `create-post.dto.ts`:
    ```TypeScript
    //TypeScript
    //üìÅsrc/posts/dto/create-post.dto.ts
    
    export class CreatePostDto {
        readonly title: string;
        readonly content: string;
        readonly userId: number;
    }
    ```
6. –°–æ–∑–¥–∞–¥–∏–º –º–µ—Ç–æ–¥ `createPost` –≤ `posts.controller.ts`. –í –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç dto –∏ image. –¢.–∫. –±—É–¥–µ–º –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã `@UseInterceptors(FileInterceptor('image'))` –∏ `UploadedFile()`:
    ```TypeScript
    //TypeScript
    //üìÅsrc/posts/posts.controller.ts
    
    import {Body, Controller, Post, UploadedFile, UseInterceptors} from '@nestjs/common';
    import { PostsService } from './posts.service';
    import {CreatePostDto} from "./dto/create-post.dto";
    import {FileInterceptor} from "@nestjs/platform-express";
    
    @Controller('posts')
    export class PostsController {
      constructor(private readonly postsService: PostsService) {}
    
      @Post()
      @UseInterceptors(FileInterceptor('image'))
      createPost(@Body() dto: CreatePostDto, @UploadedFile() image){
        return this.postsService.create(dto, image)
      }
    }
    ```
7. –°–æ–∑–¥–∞–¥–∏–º –º–µ—Ç–æ–¥ `create` –≤ `post.service.ts`. –í –Ω–µ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–∏–Ω–∂–µ–∫—Ç–∏—Ç—å –º–æ–¥–µ–ª—å, –∞ —Ç–∞–∫–∂–µ `FilesService`. (–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –±—ã–ª –¥–æ—Å—Ç—É–ø –∫ `FilesService` –≤ f`iles.module.ts` –µ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤–µ—Å—å `FilesModule` —É–∫–∞–∑–∞—Ç—å –≤ –∏–º–ø–æ—Ä—Ç–µ `posts.module.ts`).
    ```TypeScript
    //TypeScript
    //üìÅsrc/posts/posts.service.ts
    
    import { Injectable } from '@nestjs/common';
    import {CreatePostDto} from "./dto/create-post.dto";
    import {InjectModel} from "@nestjs/sequelize";
    import {Posts} from "./posts.model";
    import {FilesService} from "../files/files.service";
    
    @Injectable()
    export class PostsService {
    
        constructor(@InjectModel(Posts) private postRepository: typeof Posts, private filesService: FilesService) {}
        async create(dto: CreatePostDto, image:any) {
            const fileName = await this.filesService.createFile(image)
            const post = await this.postRepository.create({...dto, image: fileName})
            return post;
            
        }
    }
    ```
### –ú–æ–¥—É–ª—å Files
1. –í `files.service.ts` —Å–æ–∑–¥–∞—ë–º –º–µ—Ç–æ–¥ `createFile`. –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç uuid. `npm install uuid`.
    ```TypeScript
    //TypeScript
    //üìÅsrc/files/files.service.ts
    
    import {HttpException, HttpStatus, Injectable} from '@nestjs/common';
    import * as path from 'path'
    import * as fs from 'fs'
    import * as uuid from 'uuid'
    
    @Injectable()
    export class FilesService {
    
        async createFile(file): Promise<string> {
            try {
    			//–°–æ–∑–¥–∞—ë–º –∏–º—è —Ñ–∞–π–ª–∞
                const fileName = uuid.v4() + '.jpg';
    			//–ü–æ–º–µ—â–∞–µ–º —Ñ–∞–π–ª –≤ –ø–∞–ø–∫—É static
                const filePath = path.resolve(__dirname, '..', 'static')
    			//–ï—Å–ª–∏ –ø–∞–ø–∫–∏ –Ω–µ—Ç, —Ç–æ —Å–æ–∑–¥–∞—ë–º
                if (!fs.existsSync(filePath)){
                    fs.mkdirSync(filePath, {recursive: true})
                }
                fs.writeFileSync(path.join(filePath, fileName), file.buffer)
                return fileName
            }
            catch (e) {
                throw new HttpException('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞', HttpStatus.INTERNAL_SERVER_ERROR)
            }
        }
    }
    ```
   >‚ö†Ô∏è –ú–µ—Ç–æ–¥—ã —Å –ø—Ä–µ–ø–∏—Å–∫–æ–π `sync` (`existsSync`, `mkdirSync`, `writeFileSync`) –±–ª–æ–∫–∏—Ä—É—é—Ç –ø–æ—Ç–æ–∫. –û–Ω–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏, –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–ª—å–∑—è!
### Serve static
1. –ú—ã –º–æ–∂–µ–º –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã, –Ω–æ –Ω–µ –º–æ–∂–µ–º –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø–µ—Ä–µ–π–¥—è –ø–æ —Å—Å—ã–ª–∫–µ. –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ—è–≤–∏–ª–∞—Å—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å—Ç–∞—Ç–∏–∫–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–∞—á–∞—Ç—å –ø–∞–∫–µ—Ç **serve-static** `npm install --save @nestjs/serve-static`. –ü–æ—Å–ª–µ —á–µ–≥–æ –≤ –º–æ–¥—É–ª—å `app.module.ts` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª—å `ServeStaticModule` –∏ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö —É–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ `static`.
    ```TypeScript
    //TypeScript
    //üìÅsrc/app.module.ts
    
    import { Module } from '@nestjs/common';
    import { DatabaseModule } from './database/database.module';
    import { UserModule } from './user/user.module';
    import { RolesModule } from './roles/roles.module';
    import { AuthModule } from './auth/auth.module';
    import { PostsModule } from './posts/posts.module';
    import { FilesModule } from './files/files.module';
    import * as path from 'path'
    import {ServeStaticModule} from "@nestjs/serve-static";
    
    @Module({
      imports: [
        ServeStaticModule.forRoot({
          rootPath: path.resolve(__dirname,'static'),
        }),
          DatabaseModule,
          UserModule,
          RolesModule,
          AuthModule,
          PostsModule,
          FilesModule
      ],
      controllers: [],
      providers: [],
    })
    export class AppModule {}
    ```
2. –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–π–¥—è –ø–æ –ø—É—Ç–∏ http://localhost:4001/*–Ω–∞–∑–≤–∞–Ω–∏–µ-—Ñ–∞–π–ª–∞*.jpg –º—ã —É–≤–∏–¥–∏–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª.
<hr/>

## –ù–∞—á–∞–ª–æ

1. –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É `test`. –í –Ω–µ–π –±—É–¥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Å–∞–º–∏ —Ç–µ—Å—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥.

    ```json
    //üìÅtest/jest-e2e.json
    
    {
      "moduleFileExtensions": [
        "js",
        "json",
        "ts"
      ],
      "rootDir": ".",
      "testEnvironment": "node",
      "testRegex": ".e2e-spec.ts$",
      "transform": {
        "^.+\\.(t|j)s$": "ts-jest"
      }
    }
    ```

2. –¢–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π `test:e2e`. –¢.–∫. –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ **cross-env**, —Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ —Å–∫—Ä–∏–ø—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –≤ –∫–æ—Ç–æ—Ä–æ–π —É–∫–∞–∑–∞–Ω –∫–∞–∫–æ–π —Ç–∏–ø —Ñ–∞–π–ª–∞ `.env` –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–æ–≤. `"test:e2e": "cross-env NODE_ENV=development jest --config ./test/jest-e2e.json‚Äù`

## e2e —Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ User (Post, Get, Delete)

### –§—É–Ω–∫—Ü–∏—è describe, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∏–Ω–∏—Ü–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è App

1. –°–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª `user.e2e-spec.ts` - –≤ –Ω—ë–º –±—É–¥—É—Ç –æ–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.
   1. –í —Ñ—É–Ω–∫—Ü–∏–∏ `describe` –±—É–¥—É—Ç –æ–ø–∏—Å–∞–Ω—ã –≤—Å–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞;
   2. –í —Ñ—É–Ω–∫—Ü–∏–∏ `beforeEach` (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è `App` –∏ –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
   3. –í —Ñ—É–Ω–∫—Ü–∏–∏ `afterEach` (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤) –∑–∞–≤–µ—Ä—à–∞–µ–º —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

    ```tsx
    //üìÅtest/user.e2e-spec.ts
    import { Test, TestingModule } from '@nestjs/testing';
    import { AppModule } from '../src/app.module'
    import { INestApplication } from '@nestjs/common';
    import * as request from 'supertest';
    
    describe('UserController (e2e)', () => {
        let app: INestApplication;
    
        beforeEach(async () => {
            const moduleFixture: TestingModule = await Test.createTestingModule({
                imports: [AppModule],
            }).compile();
    
            app = moduleFixture.createNestApplication();
            await app.init();
        });
    
        afterEach(async () => {
            await app.close();
        });
    
    });
    ```


### –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ —Ç–µ—Å—Ç–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –í—ã—à–µ —Ñ—É–Ω–∫—Ü–∏–∏ `describe` —Å–æ–∑–¥–∞–¥–∏–º –æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ `CreateUserDto`, –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∫–∞–∂–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    ```tsx
    //üìÅtest/user.e2e-spec.ts
    
    const testUserDto: CreateUserDto = {
        email: 'testfromjest@mail.ru',
        password: 'qwerty12354'
    }
    ```

2. –í —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ `describe` –æ–±—ä—è–≤–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `createUserId`, –≤ –∫–æ—Ç–æ—Ä—É—é –±—É–¥–µ–º –ø–æ–º–µ—â–∞—Ç—å `id` —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–Ω –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–¥–∞–ª—å–Ω–µ–π—à–µ–º.
3. –í —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ `describe` —Å–æ–∑–¥–∞–¥–∏–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è `it`. –û–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç 2 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞: –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ –∏ `callback`, –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Ç–µ—Å—Ç.

    ```tsx
    //üìÅtest/user.e2e-spec.ts
    import { Test, TestingModule } from '@nestjs/testing';
    import { AppModule } from '../src/app.module'
    import { INestApplication } from '@nestjs/common';
    import * as request from 'supertest';
    import {CreateUserDto} from "../src/user/dto/create-user.dto";
    
    const testUserDto: CreateUserDto = {
        email: 'testfromjest@mail.ru',
        password: 'qwerty12354'
    }
    
    describe('UserController (e2e)', () => {
        let app: INestApplication;
        let createdUserId: number;
    
        beforeEach(async () => {
            const moduleFixture: TestingModule = await Test.createTestingModule({
                imports: [AppModule],
            }).compile();
    
            app = moduleFixture.createNestApplication();
            await app.init();
        });
    
        afterEach(async () => {
            await app.close();
        });
    
        it('successful: /users (POST)',   async () => {
            return await request(app.getHttpServer())
                .post('/users')
                .send(testUserDto)
                .expect(201)
                .then(({body}: request.Response)=>{
                    createdUserId = body.id;
                    expect(createdUserId).toBeDefined();
                })
        });
    });
    ```

   –í **callback** —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É.

   1. `post(‚Äô/users‚Äô)` - `POST` –∑–∞–ø—Ä–æ—Å –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç `/users`;
   2. `send(testUserDto)` - –≤ —Ç–µ–ª–µ –ø–æ—Å—ã–ª–∞–µ–º –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑–∞–ª –≤ `testUserDto`;
   3. `expect(201)` - –æ–∂–∏–¥–∞–µ–º –æ—Ç–≤–µ—Ç `201` (Created);
   4. –í `then` —É–∫–∞–∑—ã–≤–∞–µ–º `callback`, –≤ –∫–æ—Ç–æ—Ä–æ–º –∏–∑ `body` –æ—Ç–≤–µ—Ç–∞ –∑–∞–±–∏—Ä–∞–µ–º `id` –∏ –ø—Ä–∏—Å–≤–∞–µ–º –µ–≥–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `createdUserId`.
   5. –° –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ `expect(createUserId).toBeDefined()` —É–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –º—ã –æ–∂–∏–¥–∞–µ–º, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞.
4. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç —Å –ø–æ–º–æ—â—å—é `npm test:e2e`.

### –¢–µ—Å—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ

1. –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–µ–ª–∞—é—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º. –í –Ω–∏—Ö –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `createdUserId`, –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π –ø–æ–ª—É—á–∏–ª–∏ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    ```tsx
    //üìÅtest/user.e2e-spec.ts
    import { Test, TestingModule } from '@nestjs/testing';
    import { AppModule } from '../src/app.module'
    import { INestApplication } from '@nestjs/common';
    import * as request from 'supertest';
    import {CreateUserDto} from "../src/user/dto/create-user.dto";
    
    const testUserDto: CreateUserDto = {
        email: 'testfromjest@mail.ru',
        password: 'qwerty12354'
    }
    
    describe('UserController (e2e)', () => {
        let app: INestApplication;
        let createdUserId: number;
    
        beforeEach(async () => {
            const moduleFixture: TestingModule = await Test.createTestingModule({
                imports: [AppModule],
            }).compile();
    
            app = moduleFixture.createNestApplication();
            await app.init();
        });
    
        afterEach(async () => {
            await app.close();
        });
    
        it('successful: /users (POST)',   async () => {
            return await request(app.getHttpServer())
                .post('/users')
                .send(testUserDto)
                .expect(201)
                .then(({body}: request.Response)=>{
                    createdUserId = body.id;
                    expect(createdUserId).toBeDefined();
                })
        });
    
        it('successful: /users/:id (GET)', async ()=>{
            return await request(app.getHttpServer())
                .get(`/users/${createdUserId}`)
                .expect(200)
                .then(({body}: request.Response)=>{
                    expect(body).toBeDefined()
                })
        })
    
        it('successful: /users/:id (DELETE)', async ()=>{
            return await request(app.getHttpServer())
                .delete(`/users/${createdUserId}`)
                .expect(204)
                .then(({body}: request.Response)=>{
                    expect(body).toEqual({})
                })
        })
    });
    ```


### –¢–µ—Å—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ

1. –í `user.controller.ts` –µ—Å—Ç—å `Delete` –º–µ—Ç–æ–¥. –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–¥ `404` —Å —Å–æ–æ–±—â–∞–Ω–∏–µ–º `‚Äú–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω‚Äù`.

    ```tsx
    //üìÅsrc/user/user.controller.ts
    import {Body,Controller, Delete,Get, HttpCode,NotFoundException,Param,Post} from '@nestjs/common';
    import { UserService } from './user.service';
    import { CreateUserDto } from './dto/create-user.dto';
    import { User } from './user.model';
    
    @Controller('users')
    export class UserController {
      constructor(private readonly userService: UserService) {}
    
      @Get(':id')
      async getUserById(@Param('id') id: number) {
        const user = await this.userService.getUserById(id);
        if(!user){
          throw new NotFoundException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω')
        }
        return user;
      }
    
      @Post()
      async createUser(@Body() userDto: CreateUserDto) {
        return await this.userService.createUser(userDto);
      }
      @HttpCode(204)
      @Delete(':id')
      async delete(@Param('id') id: number){
        const deletedUser = await this.userService.deleteUser(id);
        if (!deletedUser){
          throw new NotFoundException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω')
        }
        return
      }
    }
    ```

2. –¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—à–∏–±–∫–∏

    ```tsx
    //üìÅtest/user.e2e-spec.ts
    import { Test, TestingModule } from '@nestjs/testing';
    import { AppModule } from '../src/app.module'
    import { INestApplication } from '@nestjs/common';
    import * as request from 'supertest';
    
    describe('UserController (e2e)', () => {
        let app: INestApplication;
    
        beforeEach(async () => {
            const moduleFixture: TestingModule = await Test.createTestingModule({
                imports: [AppModule],
            }).compile();
    
            app = moduleFixture.createNestApplication();
            await app.init();
        });
    
        afterEach(async () => {
            await app.close();
        });
    
        it('failed: /users/:id (DELETE)',  ()=>{
            return request(app.getHttpServer())
                .delete(`/users/${999}`)
                .expect(404, {
                    statusCode: 404,
                    message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω',
                    error: 'Not Found'
                })
        })
    });
    ```


### –¢–µ—Å—Ç—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

1. –î–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–∏–º –º–µ—Ç–æ–¥ —Å `beforeEach`, –Ω–∞ `beforeAll` (—á—Ç–æ–±—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º, –∞ —Ç–æ–ª—å–∫–æ –≤ –º–æ–º–µ–Ω—Ç –∑–∞–ø—É—Å–∫–∞). –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ –∏–∑–º–µ–Ω–∏–º `afterEach` –Ω–∞ `afterAll`.
   1. –°–æ–∑–¥–∞–¥–∏–º `loginDto` –≥–¥–µ –±—É–¥—É—Ç —É–∫–∞–∑–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏;
   2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º `cookie-parser` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—É–∫–∞–º –∏ –≤—ã–∑–æ–≤–µ–º –µ–≥–æ –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è;
   3. –°–æ–∑–¥–∞–¥–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `accessToken` –∏ `refreshToken` - –≤ –Ω–∏—Ö –±—É–¥—É—Ç —Ç–æ–∫–µ–Ω—ã;
   4. –ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é. –ò–∑ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—É—á–∞–µ–º `access` –∏ `refresh` —Ç–æ–∫–µ–Ω—ã, –∏—Ö –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤—ã—à–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ;
   5. `GET /users` —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –ø–æ—ç—Ç–æ–º—É –≤ —Ç–µ—Å—Ç–µ –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ —É–∫–∞–∂–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization` –∏ –ø–æ–º–µ—Å—Ç–∏–º —Ç—É–¥–∞ `access` —Ç–æ–∫–µ–Ω .`set('Authorization', accessToken)`;
   6. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞. –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥–∞ `afterAll`. –ü–æ–º–µ—â–∞–µ–º –≤ –∫—É–∫–∏ `refresh` —Ç–æ–∫–µ–Ω `.set("cookie", refreshToken[0])`. ‚ö†Ô∏è –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **cookie-parser**.

    ```tsx
    import { Test, TestingModule } from '@nestjs/testing';
    import { AppModule } from '../src/app.module'
    import { INestApplication } from '@nestjs/common';
    import * as request from 'supertest';
    import {CreateUserDto} from "../src/user/dto/create-user.dto";
    import * as cookieParser from 'cookie-parser';
    
    const testUserDto: CreateUserDto = {
        email: 'testfromjest@mail.ru',
        password: 'qwerty12354'
    }
    
    const loginDto:CreateUserDto = {
        email: "111bardak@rambler.ru",
        password: "qwerty"
    }
    
    describe('UserController (e2e)', () => {
        let app: INestApplication;
        let createdUserId: number;
        let accessToken: string;
        let refreshToken: string[];
    
        beforeAll(async () => {
            const moduleFixture: TestingModule = await Test.createTestingModule({
                imports: [AppModule],
            }).compile();
    
            app = moduleFixture.createNestApplication();
            app.use(cookieParser())
            await app.init();
    
            const res = await request(app.getHttpServer())
                .post('/auth/login')
                .send(loginDto)
            accessToken = res.body.accessToken;
            refreshToken = res.get('Set-Cookie')
         });
    
        afterAll(async () => {
            await request(app.getHttpServer())
                .delete('/auth/logout')
                .set("cookie", refreshToken[0])
            await app.close();
        });
    
        it('successful authorized: /users (GET)', async ()=>{
            return await request(app.getHttpServer())
                .get(`/users`)
                .set('Authorization', accessToken)
                .expect(200)
                .then(({body}: request.Response)=>{
                    expect(body).toBeDefined()
                })
        })
    });
    ```